import{d as ae,A as ne,ae as se,r as y,a as le,w as ue,k as I,f as d,i as o,M as A,G as c,K as w,E as D,F as Y,U as L,L as N,H as b,e as v}from"./index-C3vCaKLz.js";const ie={class:"grid grid-cols-1 sm:grid-cols-3 gap-6 mb-6"},de={class:"panel"},ce={class:"flex flex-wrap justify-between mb-5"},ve={class:"font-semibold text-lg dark:text-white-light"},pe={class:"mb-5 grid grid-cols-1 sm:grid-cols-4 gap-4"},ke=["value"],ye=["value"],ge={key:0},fe={class:"table-responsive"},me={class:"table-striped"},we={key:0},be={key:0},he=["colspan"],De={key:1},Se={key:2},xe={key:3},Ie={key:0},Te={class:A({})},We={key:0,class:A({})},Le={class:"flex items-center justify-between mt-5"},Ae={class:"flex items-center gap-2"},Ne={class:"flex items-center gap-2"},Me=["disabled"],qe=["disabled"],Re=ae({__name:"index",setup(Ce){const g=ne(),T=se(),W=y(!1),l=y("stock-status"),M=y([]),q=y([]),C=y([]),S=y([]),B=y([]),x=y(10),f=y(1),s=y({startDate:"",endDate:"",categoryId:"",warehouseId:"",movementType:"",stockStatus:""});le(()=>{O()}),ue([l,s,f,x],()=>{l.value!=="movement-history"&&(f.value=1),H()});const O=async()=>{S.value=T.getWarehouses,B.value=T.getCategories,H()},H=async()=>{W.value=!0;try{switch(l.value){case"stock-status":Z();break;case"movement-history":_();break;case"low-stock":ee();break}}catch(t){console.error("Rapor yüklenirken hata oluştu:",t)}finally{W.value=!1}},U=(t,e)=>t.filter(r=>{var n;return((n=r.warehouse)==null?void 0:n.id)===e}),J=(t,e)=>t.filter(r=>{var n,a;return((a=(n=r.product)==null?void 0:n.category)==null?void 0:a.id)===e}),Q=(t,e)=>t.filter(r=>{var n;if(!((n=r.product)!=null&&n.minStockLevel))return!1;switch(e){case"low":return r.quantity<r.product.minStockLevel;case"critical":return r.quantity===r.product.minStockLevel;case"normal":return r.quantity>r.product.minStockLevel}}),V=t=>{var r,n,a,u,p,k;if(!t||!t.product)return console.warn("Eksik veya null stok verisi:",t),{id:(t==null?void 0:t.id)||"unknown",product:{id:"unknown",code:"N/A",name:"Bilinmeyen Ürün",unit:"",minStockLevel:0,categoryId:"",isActive:!1,category:{id:"",name:"Kategori Yok",description:""},description:""},warehouse:{id:((r=t==null?void 0:t.warehouse)==null?void 0:r.id)||"",code:((n=t==null?void 0:t.warehouse)==null?void 0:n.code)||"N/A",name:((a=t==null?void 0:t.warehouse)==null?void 0:a.name)||"Bilinmeyen Depo"},quantity:(t==null?void 0:t.quantity)||0};const e=t.product.category||{id:"",name:"Kategori Yok",description:""};return{id:t.id,product:{id:t.product.id,code:t.product.code||"N/A",name:t.product.name||"İsimsiz Ürün",unit:t.product.unit||"",minStockLevel:t.product.minStockLevel||0,categoryId:t.product.categoryId||"",isActive:!!t.product.isActive,category:{id:e.id||"",name:e.name||"Kategori Yok",description:e.description||""},description:t.product.description||""},warehouse:{id:((u=t.warehouse)==null?void 0:u.id)||"",code:((p=t.warehouse)==null?void 0:p.code)||"N/A",name:((k=t.warehouse)==null?void 0:k.name)||"Bilinmeyen Depo"},quantity:t.quantity||0}},X=t=>({id:t.id,date:typeof t.date=="string"?t.date:t.date.toISOString(),movementNumber:t.movementNumber,type:t.type,product:{id:t.product.id,code:t.product.code,name:t.product.name,unit:t.product.unit,minStockLevel:t.product.minStockLevel,categoryId:t.product.categoryId,isActive:t.product.isActive,category:{id:t.product.category.id,name:t.product.category.name,description:t.product.category.description},description:t.product.description},quantity:t.quantity,sourceWarehouse:{id:t.sourceWarehouse.id,code:t.sourceWarehouse.code,name:t.sourceWarehouse.name},targetWarehouse:t.targetWarehouse?{id:t.targetWarehouse.id,code:t.targetWarehouse.code,name:t.targetWarehouse.name}:void 0,description:t.description}),Z=()=>{let e=[...T.getStocks.map(V)];if(!g.isAdmin){const r=g.getAuthorizedDepot(),n=S.value.find(a=>a.code===r);n&&(e=U(e,n.id))}s.value.warehouseId&&(e=U(e,s.value.warehouseId)),s.value.categoryId&&(e=J(e,s.value.categoryId)),s.value.stockStatus&&(e=Q(e,s.value.stockStatus)),M.value=e},_=()=>{let e=[...T.getMovements.map(X)];const r=g.isAdmin?null:g.getAuthorizedDepot(),n=r?S.value.find(a=>a.code===r):null;if(n&&(e=e.filter(a=>{var u,p;return((u=a.sourceWarehouse)==null?void 0:u.id)===n.id||((p=a.targetWarehouse)==null?void 0:p.id)===n.id})),s.value.startDate&&s.value.endDate){const a=new Date(s.value.startDate),u=new Date(s.value.endDate);u.setHours(23,59,59,999),e=e.filter(p=>{try{const k=new Date(p.date);return!isNaN(k.getTime())&&k>=a&&k<=u}catch{return!1}})}s.value.warehouseId&&(e=e.filter(a=>{var u,p;return((u=a.sourceWarehouse)==null?void 0:u.id)===s.value.warehouseId||((p=a.targetWarehouse)==null?void 0:p.id)===s.value.warehouseId})),s.value.movementType&&(e=e.filter(a=>a.type===s.value.movementType)),e.sort((a,u)=>new Date(u.date).getTime()-new Date(a.date).getTime()),q.value=e},ee=()=>{let r=[...T.getStocks.map(V).filter(n=>{var a;return n.quantity<=(((a=n.product)==null?void 0:a.minStockLevel)||0)})];if(!g.isAdmin){const n=g.getAuthorizedDepot(),a=S.value.find(u=>u.code===n);a&&(r=r.filter(u=>{var p;return((p=u.warehouse)==null?void 0:p.id)===a.id}))}s.value.warehouseId&&(r=r.filter(n=>{var a;return((a=n.warehouse)==null?void 0:a.id)===s.value.warehouseId})),s.value.categoryId&&(r=r.filter(n=>{var a,u;return((u=(a=n.product)==null?void 0:a.category)==null?void 0:u.id)===s.value.categoryId})),C.value=r},te=I(()=>{if(g.isAdmin)return S.value;const t=g.getAuthorizedDepot();return S.value.filter(e=>e.code===t)}),K=t=>{l.value=t},j=t=>{if(!t)return"-";try{const e=new Date(t);return isNaN(e.getTime())?"-":e.toLocaleString("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(e){return console.error("Tarih formatlama hatası:",e),"-"}},z=t=>{switch(t){case"in":return"Giriş";case"out":return"Çıkış";case"transfer":return"Transfer";default:return t}},$=t=>{var e;return(e=t==null?void 0:t.product)!=null&&e.minStockLevel?t.quantity>t.product.minStockLevel?"Normal":t.quantity===t.product.minStockLevel?"Kritik":"Düşük":"-"},oe=async()=>{try{W.value=!0;const t=R.value,e=l.value==="stock-status"?"Stok_Durum":l.value==="movement-history"?"Hareket_Gecmisi":"Kritik_Stok",r=new Date().toLocaleDateString("tr-TR").replace(/\./g,"-"),n=`${e}_${r}.csv`;let a="",u=[];l.value==="movement-history"?(a="Hareket No,Tarih,Hareket Tipi,Ürün,Miktar,Kaynak Depo,Hedef Depo,Açıklama",u=t.map(i=>{var P;return[i.movementNumber,j(i.date),z(i.type),i.product.name,i.quantity.toString(),i.sourceWarehouse.name,i.type==="transfer"&&((P=i.targetWarehouse)==null?void 0:P.name)||"-",i.description||"-"].join(",")})):(a="Ürün Kodu,Ürün Adı,Kategori,Depo,Miktar,Min. Stok,Durum"+(l.value==="low-stock"?",Eksik Miktar":""),u=t.map(i=>[i.product.code,i.product.name,i.product.category.name,i.warehouse.name,i.quantity.toString(),i.product.minStockLevel.toString(),$(i),l.value==="low-stock"?(i.product.minStockLevel-i.quantity).toString():""].filter(Boolean).join(",")));const p=[a,...u].join(`
`),k=new Blob([p],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a");m.href=URL.createObjectURL(k),m.setAttribute("download",n),document.body.appendChild(m),m.click(),document.body.removeChild(m)}catch(t){console.error("Rapor dışa aktarılırken hata oluştu:",t)}finally{W.value=!1}},R=I(()=>{switch(l.value){case"stock-status":return M.value;case"movement-history":return q.value;case"low-stock":return C.value;default:return[]}}),E=I(()=>Math.max(1,Math.ceil(R.value.length/x.value))),G=I(()=>{const t=(f.value-1)*x.value,e=t+x.value;return R.value.slice(t,e)}),F=t=>"warehouse"in t&&!("sourceWarehouse"in t),h=t=>"sourceWarehouse"in t&&"type"in t,re=I(()=>t=>F(t)?t.warehouse:null);return I(()=>t=>h(t)?{sourceWarehouse:t.sourceWarehouse,targetWarehouse:t.targetWarehouse,type:t.type,movementNumber:t.movementNumber,date:t.date}:null),(t,e)=>(v(),d("div",null,[o("div",ie,[o("div",{class:A(["panel cursor-pointer transition-all duration-300 hover:shadow-[0_0_15px_1px_rgba(0,0,0,0.15)] bg-success/10 dark:bg-success/20 hover:bg-success/20 dark:hover:bg-success/30",{"ring-2 ring-success":l.value==="stock-status"}]),onClick:e[0]||(e[0]=r=>K("stock-status"))},e[12]||(e[12]=[o("div",{class:"flex items-start"},[o("div",{class:"flex-1"},[o("h5",{class:"font-semibold text-lg mb-2"},"Stok Durum Raporu"),o("p",{class:"text-[13px] text-white-dark"},"Tüm ürünlerin güncel stok durumunu görüntüleyin")])],-1)]),2),o("div",{class:A(["panel cursor-pointer transition-all duration-300 hover:shadow-[0_0_15px_1px_rgba(0,0,0,0.15)] bg-info/10 dark:bg-info/20 hover:bg-info/20 dark:hover:bg-info/30",{"ring-2 ring-info":l.value==="movement-history"}]),onClick:e[1]||(e[1]=r=>K("movement-history"))},e[13]||(e[13]=[o("div",{class:"flex items-start"},[o("div",{class:"flex-1"},[o("h5",{class:"font-semibold text-lg mb-2"},"Hareket Geçmişi"),o("p",{class:"text-[13px] text-white-dark"},"Stok hareketlerini analiz edin")])],-1)]),2),o("div",{class:A(["panel cursor-pointer transition-all duration-300 hover:shadow-[0_0_15px_1px_rgba(0,0,0,0.15)] bg-warning/10 dark:bg-warning/20 hover:bg-warning/20 dark:hover:bg-warning/30",{"ring-2 ring-warning":l.value==="low-stock"}]),onClick:e[2]||(e[2]=r=>K("low-stock"))},e[14]||(e[14]=[o("div",{class:"flex items-start"},[o("div",{class:"flex-1"},[o("h5",{class:"font-semibold text-lg mb-2"},"Kritik Stok Raporu"),o("p",{class:"text-[13px] text-white-dark"},"Minimum stok seviyesinin altındaki ürünleri listeleyin")])],-1)]),2)]),o("div",de,[o("div",ce,[o("h5",ve,c(l.value==="stock-status"?"Stok Durum Raporu":l.value==="movement-history"?"Hareket Geçmişi":l.value==="low-stock"?"Kritik Stok Raporu":""),1),o("button",{class:"btn btn-primary",onClick:oe}," Dışa Aktar ")]),o("div",pe,[l.value==="movement-history"?(v(),d(w,{key:0},[o("div",null,[e[15]||(e[15]=o("label",null,"Başlangıç Tarihi",-1)),D(o("input",{type:"date",class:"form-input","onUpdate:modelValue":e[3]||(e[3]=r=>s.value.startDate=r)},null,512),[[Y,s.value.startDate]])]),o("div",null,[e[16]||(e[16]=o("label",null,"Bitiş Tarihi",-1)),D(o("input",{type:"date",class:"form-input","onUpdate:modelValue":e[4]||(e[4]=r=>s.value.endDate=r)},null,512),[[Y,s.value.endDate]])]),o("div",null,[e[18]||(e[18]=o("label",null,"Hareket Tipi",-1)),D(o("select",{class:"form-select","onUpdate:modelValue":e[5]||(e[5]=r=>s.value.movementType=r)},e[17]||(e[17]=[o("option",{value:""},"Tümü",-1),o("option",{value:"in"},"Giriş",-1),o("option",{value:"out"},"Çıkış",-1),o("option",{value:"transfer"},"Transfer",-1)]),512),[[L,s.value.movementType]])])],64)):(v(),d(w,{key:1},[o("div",null,[e[20]||(e[20]=o("label",null,"Kategori",-1)),D(o("select",{class:"form-select","onUpdate:modelValue":e[6]||(e[6]=r=>s.value.categoryId=r)},[e[19]||(e[19]=o("option",{value:""},"Tümü",-1)),(v(!0),d(w,null,N(B.value,r=>(v(),d("option",{key:r.id,value:r.id},c(r.name),9,ke))),128))],512),[[L,s.value.categoryId]])]),o("div",null,[e[22]||(e[22]=o("label",null,"Depo",-1)),D(o("select",{class:"form-select","onUpdate:modelValue":e[7]||(e[7]=r=>s.value.warehouseId=r)},[e[21]||(e[21]=o("option",{value:""},"Tümü",-1)),(v(!0),d(w,null,N(te.value,r=>(v(),d("option",{key:r.id,value:r.id},c(r.name),9,ye))),128))],512),[[L,s.value.warehouseId]])]),l.value==="stock-status"?(v(),d("div",ge,[e[24]||(e[24]=o("label",null,"Stok Durumu",-1)),D(o("select",{class:"form-select","onUpdate:modelValue":e[8]||(e[8]=r=>s.value.stockStatus=r)},e[23]||(e[23]=[o("option",{value:""},"Tümü",-1),o("option",{value:"normal"},"Normal",-1),o("option",{value:"critical"},"Kritik",-1),o("option",{value:"low"},"Düşük",-1)]),512),[[L,s.value.stockStatus]])])):b("",!0)],64))]),o("div",fe,[o("table",me,[o("thead",null,[o("tr",null,[l.value==="stock-status"||l.value==="low-stock"?(v(),d(w,{key:0},[e[25]||(e[25]=o("th",null,"Ürün Kodu",-1)),e[26]||(e[26]=o("th",null,"Ürün Adı",-1)),e[27]||(e[27]=o("th",null,"Kategori",-1)),e[28]||(e[28]=o("th",null,"Depo",-1)),e[29]||(e[29]=o("th",null,"Miktar",-1)),e[30]||(e[30]=o("th",null,"Min. Stok",-1)),l.value==="low-stock"?(v(),d("th",we,"Eksik Miktar")):b("",!0),e[31]||(e[31]=o("th",null,"Durum",-1))],64)):l.value==="movement-history"?(v(),d(w,{key:1},[e[32]||(e[32]=o("th",null,"Hareket No",-1)),e[33]||(e[33]=o("th",null,"Tarih",-1)),e[34]||(e[34]=o("th",null,"Hareket Tipi",-1)),e[35]||(e[35]=o("th",null,"Ürün",-1)),e[36]||(e[36]=o("th",null,"Miktar",-1)),e[37]||(e[37]=o("th",null,"Kaynak Depo",-1)),e[38]||(e[38]=o("th",null,"Hedef Depo",-1)),e[39]||(e[39]=o("th",null,"Açıklama",-1))],64)):b("",!0)])]),o("tbody",null,[W.value?(v(),d("tr",be,[o("td",{colspan:l.value==="movement-history"?8:7,class:"text-center"},e[40]||(e[40]=[o("div",{class:"flex justify-center items-center p-4"},[o("div",{class:"animate-spin rounded-full h-6 w-6 border-2 border-primary border-l-transparent"})],-1)]),8,he)])):l.value==="stock-status"&&M.value.length===0?(v(),d("tr",De,e[41]||(e[41]=[o("td",{colspan:"7",class:"text-center"},"Stok verisi bulunamadı.",-1)]))):l.value==="movement-history"&&q.value.length===0?(v(),d("tr",Se,e[42]||(e[42]=[o("td",{colspan:"8",class:"text-center"},"Hareket verisi bulunamadı.",-1)]))):l.value==="low-stock"&&C.value.length===0?(v(),d("tr",xe,e[43]||(e[43]=[o("td",{colspan:"8",class:"text-center"},"Kritik stok seviyesinde ürün bulunmamaktadır.",-1)]))):b("",!0),l.value==="stock-status"||l.value==="low-stock"?(v(!0),d(w,{key:4},N(G.value,r=>{var n,a,u,p,k,m,i;return v(),d("tr",{key:r.id},[o("td",null,c(((n=r.product)==null?void 0:n.code)||"-"),1),o("td",null,c(((a=r.product)==null?void 0:a.name)||"-"),1),o("td",null,c(((p=(u=r.product)==null?void 0:u.category)==null?void 0:p.name)||"-"),1),o("td",null,c(((k=re.value(r))==null?void 0:k.name)||"-"),1),o("td",null,c(r.quantity),1),o("td",null,c(((m=r.product)==null?void 0:m.minStockLevel)||0),1),l.value==="low-stock"?(v(),d("td",Ie,c((((i=r.product)==null?void 0:i.minStockLevel)||0)-r.quantity),1)):b("",!0),o("td",null,[o("span",Te,c($(F(r)?r:void 0)),1)])])}),128)):b("",!0),l.value==="movement-history"?(v(!0),d(w,{key:5},N(G.value,r=>{var n,a,u;return v(),d("tr",{key:r.id},[o("td",null,c(h(r)?r.movementNumber:"-"),1),o("td",null,c(h(r)?j(r.date):"-"),1),o("td",null,[h(r)?(v(),d("span",We,c(z(r.type)),1)):b("",!0)]),o("td",null,c(((n=r.product)==null?void 0:n.name)||"-"),1),o("td",null,c(r.quantity),1),o("td",null,c(h(r)?(a=r.sourceWarehouse)==null?void 0:a.name:"-"),1),o("td",null,c(h(r)&&r.type==="transfer"?(u=r.targetWarehouse)==null?void 0:u.name:"-"),1),o("td",null,c(h(r)?r.description:"-"),1)])}),128)):b("",!0)])])]),o("div",Le,[o("div",Ae,[D(o("select",{class:"form-select w-20","onUpdate:modelValue":e[9]||(e[9]=r=>x.value=r)},e[44]||(e[44]=[o("option",null,"10",-1),o("option",null,"20",-1),o("option",null,"50",-1),o("option",null,"100",-1)]),512),[[L,x.value]]),e[45]||(e[45]=o("span",null,"kayıt gösteriliyor",-1))]),o("div",Ne,[o("button",{class:"btn btn-outline-primary p-2",disabled:f.value===1,onClick:e[10]||(e[10]=r=>f.value--)}," ← ",8,Me),o("span",null,"Sayfa "+c(f.value)+" / "+c(E.value),1),o("button",{class:"btn btn-outline-primary p-2",disabled:f.value===E.value,onClick:e[11]||(e[11]=r=>f.value++)}," → ",8,qe)])])])]))}});export{Re as default};
