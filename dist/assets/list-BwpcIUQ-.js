import{d as ce,G as ve,u as pe,r as v,a as me,ap as X,c as be,e as T,R as Z,aq as he,i as u,j as e,l as y,q as S,K as m,F as U,k as $,y as o,J as fe,s as b,v as D,D as k,L as ge,x as ye,C as d,a7 as ee,ar as ke,as as xe,at as je,au as _e,av as we}from"./index-d431Q8yB.js";import{I as Se}from"./icon-plus-GW1fWUBD.js";import{_ as De}from"./icon-pencil.vue_vue_type_script_setup_true_lang-xfKVdPJ3.js";import{I as Ae}from"./icon-trash-lines-ug_c1Xl1.js";import{_ as Pe}from"./icon-box.vue_vue_type_script_setup_true_lang-DJhmXt6K.js";const Ce={class:"panel"},We={class:"flex items-center justify-between mb-5"},ze={class:"table-responsive"},Ie={class:"table-striped"},Le={key:0},Me={key:1},qe={key:0,class:"badge badge-outline-info"},Te={key:1,class:"text-gray-400"},Ue={class:"flex gap-2"},$e=["onClick"],Be=["onClick"],Ve=["onClick"],Ne={class:"flex items-center justify-between mt-5"},Ee={class:"text-sm"},Ke={class:"flex items-center gap-2"},Fe=["disabled"],Oe={class:"text-sm"},Ye=["disabled"],Ge={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},Re={class:"panel bg-white dark:bg-gray-800 w-full max-w-lg"},He={class:"flex items-center justify-between mb-5"},Je={class:"font-semibold text-lg"},Qe={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Xe={class:"mb-4"},Ze=["readonly"],et={key:0,class:"text-red-500 text-xs mt-1"},tt={class:"mb-4"},st={key:0,class:"text-red-500 text-xs mt-1"},lt={class:"mb-4 sm:col-span-2"},ot={key:0,class:"text-red-500 text-xs mt-1"},at={class:"mb-4"},nt={key:0,class:"text-red-500 text-xs mt-1"},rt={class:"mb-4"},it={class:"flex items-center mt-2"},ut={class:"inline-flex"},dt={class:"mb-4 sm:col-span-2"},ct=["value"],vt={class:"flex justify-end gap-4 mt-4"},pt=["disabled"],mt={key:1,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},bt={class:"panel bg-white dark:bg-gray-800 w-full max-w-4xl"},ht={class:"flex items-center justify-between mb-5"},ft={class:"font-semibold text-lg"},gt={class:"mb-4"},yt={class:"table-responsive"},kt={class:"table-striped"},xt={key:0},jt={key:1},Ct=ce({__name:"list",setup(_t){const A=ve(),a=pe(),x=v(!1),C=v(!1),P=v(!1),W=v(!1),h=v(!1),p=v([]),z=v(null),j=v([]),I=v(!1),_=v(""),f=v(1),L=v(10),n=v({}),r=v({code:"",name:"",address:"",manager:"",isActive:!0,projectId:""}),B=v([]);me(async()=>{await te(),await M(),await F(),X.on("project-changed",V),await de()}),be(()=>{X.off("project-changed",V)});const V=async()=>{console.log("Project changed event received, reloading warehouses..."),await M(),await F()},te=async()=>{try{if(a.isInitialized||await a.initializeStore(),console.log("Mevcut depolar:",a.warehouses),a.warehouses.length===0){console.log("Test deposu ekleniyor...");const l={code:"DEPO01",name:"Test Depo",address:"Test Adres",manager:"Test Yönetici",isActive:!0};await a.addWarehouse(l),console.log("Test depo eklendi, veri tabanını kontrol edin."),await a.refreshData()}}catch(l){console.error("Test depo ekleme hatası:",l)}},M=async()=>{x.value=!0;try{a.isInitialized||await a.initializeStore(),console.log("Raw warehouses from store:",a.warehouses),a.activeProjectId&&a.projectWarehouses.length>0?(console.log("Using project warehouses:",a.projectWarehouses),p.value=[...a.projectWarehouses]):(console.log("Using all warehouses:",a.warehouses),p.value=[...a.warehouses]),p.value.length>0&&console.log("Sample warehouse data:",p.value[0])}catch(l){console.error("Depolar yüklenirken hata oluştu:",l)}finally{x.value=!1}},se=()=>{h.value=!1,r.value={code:"",name:"",address:"",manager:"",isActive:!0,projectId:""},n.value={},P.value=!0},le=async l=>{h.value=!0,r.value={...l,address:l.address||"",manager:l.manager||"",projectId:""};try{const t=ke(xe(je,"projectWarehouses"),_e("warehouseId","==",l.id)),i=await we(t);if(!i.empty){const s=i.docs[0].data().projectId;r.value.projectId=s,console.log(`Depo (${l.id}) şu projeye atanmış: ${s}`)}}catch(t){console.error("Depo-proje ilişkisi yüklenirken hata oluştu:",t)}n.value={},P.value=!0},q=()=>{P.value=!1},oe=()=>(n.value={},r.value.code.trim()||(n.value.code="Depo kodu zorunludur"),r.value.name.trim()||(n.value.name="Depo adı zorunludur"),r.value.address.trim()||(n.value.address="Adres zorunludur"),r.value.manager.trim()||(n.value.manager="Sorumlu zorunludur"),Object.keys(n.value).length===0),ae=async()=>{if(oe()){C.value=!0;try{const l={...r.value};h.value&&l.id?await a.updateWarehouse(l.id,l):await a.addWarehouse(l),await M(),q()}catch(l){console.error("Depo kaydedilirken hata oluştu:",l)}finally{C.value=!1}}},ne=async l=>{if(confirm("Bu depoyu silmek istediğinizden emin misiniz?")){x.value=!0;try{a.deleteWarehouse(l),p.value=a.getWarehouses}catch(t){console.error("Depo silinirken hata oluştu:",t)}finally{x.value=!1}}},re=async l=>{z.value=l,W.value=!0,I.value=!0;try{const t=a.getStocksByWarehouseId(l.id);j.value=Array.isArray(t)?t.map(i=>{const s=a.products.find(c=>c.id===i.productId);return{...i,product:s||null}}):[]}catch(t){console.error("Stok durumu yüklenirken hata oluştu:",t)}finally{I.value=!1}},N=()=>{W.value=!1,z.value=null,j.value=[],_.value=""},ie=T(()=>{if(!_.value)return j.value;const l=_.value.toLowerCase();return j.value.filter(t=>{var c,w;const i=((c=t.product)==null?void 0:c.name)||"",s=((w=t.product)==null?void 0:w.code)||"";return i.toLowerCase().includes(l)||s.toLowerCase().includes(l)})}),ue=l=>{var t;return(t=l.product)!=null&&t.minStockLevel?l.quantity>l.product.minStockLevel?"Normal":l.quantity===l.product.minStockLevel?"Kritik":"Düşük":"Belirsiz"},E=T(()=>{let l=[];if(A.isAdmin)l=[...a.warehouses],console.log("Admin kullanıcısı için tüm depolar gösteriliyor:",l.length);else{const s=A.getAuthorizedDepot||"";l=p.value.filter(c=>c.code===s)}const t=(f.value-1)*L.value,i=t+L.value;return l.slice(t,i)}),K=T(()=>{const l=A.getAuthorizedDepot||"",t=A.isAdmin?p.value.length:p.value.filter(i=>i.code===l).length;return Math.max(1,Math.ceil(t/L.value))}),g=v({}),F=async()=>{try{console.log("Loading warehouse-project relations...");const l=Z();g.value={},await l.loadUserProjects();const t=l.projects;console.log("Projects fetched:",t.length);for(const i of t)try{const s=await he.getWarehousesByProject(i.id);console.log(`Project ${i.name} has ${s.length} warehouses`);for(const c of s)g.value[c.id]||(g.value[c.id]=[]),g.value[c.id].push(i.name)}catch(s){console.error(`Error loading warehouses for project ${i.id}:`,s)}console.log("Final Warehouse-Project mappings:",g.value)}catch(l){console.error("Warehouse-project relations error:",l)}},O=l=>g.value[l]||[],de=async()=>{try{const l=Z();await l.loadUserProjects(),B.value=l.projects}catch(l){console.error("Projeler yüklenirken hata oluştu:",l)}};return(l,t)=>{var i;return d(),u("div",null,[e("div",Ce,[e("div",We,[t[10]||(t[10]=e("h5",{class:"font-semibold text-lg dark:text-white-light"},"Depolar",-1)),e("button",{class:"btn btn-primary",onClick:se},[y(Se,{class:"w-5 h-5 ltr:mr-2 rtl:ml-2"}),t[9]||(t[9]=S(" Yeni Depo Ekle "))])]),e("div",ze,[e("table",Ie,[t[13]||(t[13]=e("thead",null,[e("tr",null,[e("th",null,"Depo Kodu"),e("th",null,"Depo Adı"),e("th",null,"Adres"),e("th",null,"Sorumlu"),e("th",null,"Proje"),e("th",null,"Durum"),e("th",null,"İşlemler")])],-1)),e("tbody",null,[x.value?(d(),u("tr",Le,t[11]||(t[11]=[e("td",{colspan:"7",class:"text-center"},[e("div",{class:"flex justify-center items-center p-4"},[e("div",{class:"animate-spin rounded-full h-6 w-6 border-2 border-primary border-l-transparent"})])],-1)]))):E.value.length===0?(d(),u("tr",Me,t[12]||(t[12]=[e("td",{colspan:"7",class:"text-center"},"Henüz depo bulunmamaktadır.",-1)]))):m("",!0),(d(!0),u(U,null,$(E.value,s=>(d(),u("tr",{key:s.id},[e("td",null,o(s.code),1),e("td",null,o(s.name),1),e("td",null,o(s.address),1),e("td",null,o(s.manager),1),e("td",null,[O(s.id).length>0?(d(),u("span",qe,o(O(s.id).join(", ")),1)):(d(),u("span",Te,"Atanmamış"))]),e("td",null,[e("span",{class:k({"badge badge-success text-black":s.isActive,"badge badge-danger text-black":!s.isActive})},o(s.isActive?"Aktif":"Pasif"),3)]),e("td",null,[e("div",Ue,[e("button",{class:"btn btn-sm btn-outline-primary",onClick:c=>le(s)},[y(De,{class:"w-4.5 h-4.5"})],8,$e),e("button",{class:"btn btn-sm btn-outline-danger",onClick:c=>ne(s.id)},[y(Ae,{class:"w-4.5 h-4.5"})],8,Be),e("button",{class:"btn btn-sm btn-outline-info",onClick:c=>re(s)},[y(Pe,{class:"w-4.5 h-4.5"})],8,Ve)])])]))),128))])])]),e("div",Ne,[e("p",Ee,"Toplam: "+o(p.value.length)+" depo",1),e("div",Ke,[e("button",{class:"btn btn-sm btn-outline-primary",disabled:f.value===1,onClick:t[0]||(t[0]=s=>f.value--)}," Önceki ",8,Fe),e("span",Oe,o(f.value)+" / "+o(K.value),1),e("button",{class:"btn btn-sm btn-outline-primary",disabled:f.value===K.value,onClick:t[1]||(t[1]=s=>f.value++)}," Sonraki ",8,Ye)])])]),P.value?(d(),u("div",Ge,[e("div",Re,[e("div",He,[e("h5",Je,o(h.value?"Depo Düzenle":"Yeni Depo Ekle"),1),e("button",{class:"text-gray-400 hover:text-gray-800",onClick:q},[y(ee,{class:"w-5 h-5"})])]),e("form",{onSubmit:fe(ae,["prevent"])},[e("div",Qe,[e("div",Xe,[t[14]||(t[14]=e("label",null,[S("Depo Kodu "),e("span",{class:"text-red-500"},"*")],-1)),b(e("input",{type:"text",class:k(["form-input",{"border-red-500":n.value.code}]),"onUpdate:modelValue":t[2]||(t[2]=s=>r.value.code=s),required:"",readonly:h.value},null,10,Ze),[[D,r.value.code]]),n.value.code?(d(),u("p",et,o(n.value.code),1)):m("",!0)]),e("div",tt,[t[15]||(t[15]=e("label",null,[S("Depo Adı "),e("span",{class:"text-red-500"},"*")],-1)),b(e("input",{type:"text",class:k(["form-input",{"border-red-500":n.value.name}]),"onUpdate:modelValue":t[3]||(t[3]=s=>r.value.name=s),required:""},null,2),[[D,r.value.name]]),n.value.name?(d(),u("p",st,o(n.value.name),1)):m("",!0)]),e("div",lt,[t[16]||(t[16]=e("label",null,[S("Adres "),e("span",{class:"text-red-500"},"*")],-1)),b(e("textarea",{class:k(["form-textarea",{"border-red-500":n.value.address}]),rows:"3","onUpdate:modelValue":t[4]||(t[4]=s=>r.value.address=s),required:""},null,2),[[D,r.value.address]]),n.value.address?(d(),u("p",ot,o(n.value.address),1)):m("",!0)]),e("div",at,[t[17]||(t[17]=e("label",null,[S("Sorumlu "),e("span",{class:"text-red-500"},"*")],-1)),b(e("input",{type:"text",class:k(["form-input",{"border-red-500":n.value.manager}]),"onUpdate:modelValue":t[5]||(t[5]=s=>r.value.manager=s),required:""},null,2),[[D,r.value.manager]]),n.value.manager?(d(),u("p",nt,o(n.value.manager),1)):m("",!0)]),e("div",rt,[t[19]||(t[19]=e("label",null,"Durum",-1)),e("div",it,[e("label",ut,[b(e("input",{type:"checkbox",class:"form-checkbox","onUpdate:modelValue":t[6]||(t[6]=s=>r.value.isActive=s)},null,512),[[ge,r.value.isActive]]),t[18]||(t[18]=e("span",null,"Aktif",-1))])])]),e("div",dt,[t[21]||(t[21]=e("label",null,"Proje",-1)),b(e("select",{class:"form-select","onUpdate:modelValue":t[7]||(t[7]=s=>r.value.projectId=s)},[t[20]||(t[20]=e("option",{value:""},"Proje Seçin (Opsiyonel)",-1)),(d(!0),u(U,null,$(B.value,s=>(d(),u("option",{key:s.id,value:s.id},o(s.name),9,ct))),128))],512),[[ye,r.value.projectId]]),t[22]||(t[22]=e("p",{class:"text-xs mt-1 text-gray-500"}," Depoyu bir projeyle ilişkilendirmek isterseniz seçebilirsiniz. ",-1))])]),e("div",vt,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:q}," İptal "),e("button",{type:"submit",class:"btn btn-primary",disabled:C.value},o(h.value?"Güncelle":"Ekle"),9,pt)])],32)])])):m("",!0),W.value?(d(),u("div",mt,[e("div",bt,[e("div",ht,[e("h5",ft,o((i=z.value)==null?void 0:i.name)+" - Stok Durumu",1),e("button",{class:"text-gray-400 hover:text-gray-800",onClick:N},[y(ee,{class:"w-5 h-5"})])]),e("div",gt,[b(e("input",{type:"text",class:"form-input","onUpdate:modelValue":t[8]||(t[8]=s=>_.value=s),placeholder:"Ürün Ara..."},null,512),[[D,_.value]])]),e("div",yt,[e("table",kt,[t[25]||(t[25]=e("thead",null,[e("tr",null,[e("th",null,"Ürün Kodu"),e("th",null,"Ürün Adı"),e("th",null,"Miktar"),e("th",null,"Birim"),e("th",null,"Min. Stok"),e("th",null,"Durum")])],-1)),e("tbody",null,[I.value?(d(),u("tr",xt,t[23]||(t[23]=[e("td",{colspan:"6",class:"text-center"},[e("div",{class:"flex justify-center items-center p-4"},[e("div",{class:"animate-spin rounded-full h-6 w-6 border-2 border-primary border-l-transparent"})])],-1)]))):j.value.length===0?(d(),u("tr",jt,t[24]||(t[24]=[e("td",{colspan:"6",class:"text-center"},"Bu depoda ürün bulunmamaktadır.",-1)]))):m("",!0),(d(!0),u(U,null,$(ie.value,s=>{var c,w,Y,G,R,H,J,Q;return d(),u("tr",{key:s.productId},[e("td",null,o(((c=s.product)==null?void 0:c.code)||"N/A"),1),e("td",null,o(((w=s.product)==null?void 0:w.name)||"N/A"),1),e("td",null,o(s.quantity),1),e("td",null,o(((Y=s.product)==null?void 0:Y.unit)||"N/A"),1),e("td",null,o(((G=s.product)==null?void 0:G.minStockLevel)||0),1),e("td",null,[e("span",{class:k({"badge badge-success text-black":((R=s.product)==null?void 0:R.minStockLevel)&&s.quantity>s.product.minStockLevel,"badge badge-warning text-black":((H=s.product)==null?void 0:H.minStockLevel)&&s.quantity===s.product.minStockLevel,"badge badge-danger text-black":((J=s.product)==null?void 0:J.minStockLevel)&&s.quantity<s.product.minStockLevel,"badge badge-info text-black":!((Q=s.product)!=null&&Q.minStockLevel)})},o(ue(s)),3)])])}),128))])])]),e("div",{class:"flex justify-end mt-6"},[e("button",{class:"btn btn-outline-primary",onClick:N}," Kapat ")])])])):m("",!0)])}}});export{Ct as default};
