import{y as fe,m as _,l as ge,ad as ye,r as c,t as he,ah as te,ai as ke,a5 as se,am as xe,c as o,a as e,I as w,e as g,d as m,S as M,U as T,O as n,L as je,M as b,N as z,V as S,P as _e,a7 as le,o as a,a3 as we,ab as Se,q as Ae,f as De,g as Pe,z as Ie,h as ze}from"./index-CMVsiJL9.js";import{I as We}from"./icon-plus-BXC3-OCg.js";import{_ as Ce}from"./icon-pencil.vue_vue_type_script_setup_true_lang-pNE-cN8a.js";import{I as Le}from"./icon-trash-lines-4s8JVsKe.js";import{_ as Me}from"./icon-box.vue_vue_type_script_setup_true_lang-BAlL3m0M.js";import{I as oe}from"./icon-x-C5nNggym.js";const Te={class:"panel"},Ne={class:"flex items-center justify-between mb-5"},Ue={class:"table-responsive"},Ve={class:"table-striped"},Be={key:0},qe={key:1},$e={key:0,class:"badge badge-outline-info"},Ee={key:1,class:"text-gray-400"},Re={class:"flex gap-2"},Ke=["onClick"],Ye=["onClick"],Fe=["onClick"],Oe={class:"flex items-center justify-between mt-5"},Ge={class:"text-sm"},He={class:"flex items-center gap-2"},Je=["disabled"],Qe={class:"text-sm"},Xe=["disabled"],Ze={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},et={class:"panel bg-white dark:bg-gray-800 w-full max-w-lg"},tt={class:"flex items-center justify-between mb-5"},st={class:"font-semibold text-lg"},lt={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},ot={class:"mb-4"},at=["readonly"],nt={key:0,class:"text-red-500 text-xs mt-1"},rt={class:"mb-4"},it={key:0,class:"text-red-500 text-xs mt-1"},ut={class:"mb-4 sm:col-span-2"},dt={key:0,class:"text-red-500 text-xs mt-1"},ct={class:"mb-4"},vt={key:0,class:"text-red-500 text-xs mt-1"},mt={class:"mb-4"},pt={class:"flex items-center mt-2"},bt={class:"inline-flex"},ft={class:"mb-4 sm:col-span-2"},gt=["value"],yt={class:"flex justify-end gap-4 mt-4"},ht=["disabled"],kt={key:1,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},xt={class:"panel bg-white dark:bg-gray-800 w-full max-w-4xl"},jt={class:"flex items-center justify-between mb-5"},_t={class:"font-semibold text-lg"},wt={class:"flex gap-4 mb-4"},St={class:"flex-1"},At={class:"w-64"},Dt=["value"],Pt={class:"table-responsive"},It={class:"table-striped"},zt={key:0},Wt={key:1},Ct={key:0,class:"badge badge-outline-info"},Lt={key:1,class:"badge badge-outline-success"},Mt={key:2,class:"text-gray-400"},Et=fe({__name:"list",setup(Tt){const A=_(()=>{try{return we()}catch(l){return console.warn("Rol servisi erişilemedi:",l),null}});_(()=>{try{if(A.value)return A.value.isAdmin()}catch(l){console.warn("Rol servisi ile admin kontrolü yapılamadı:",l)}return y.isAdmin});const N=_(()=>{try{if(A.value)return A.value.hasPermission(Se.EDIT_INVENTORY)||A.value.isAdmin()}catch(l){console.warn("Rol servisi ile izin kontrolü yapılamadı:",l)}return y.isAdmin}),y=ge(),i=ye(),D=c(!1),U=c(!1),W=c(!1),V=c(!1),h=c(!1),p=c([]),B=c(null),C=c([]),q=c(!1),P=c(""),k=c(""),x=c(1),$=c(10),u=c({}),d=c({code:"",name:"",address:"",manager:"",isActive:!0,projectId:""}),L=c([]);he(async()=>{await be(),await ae(),await E(),await G(),te.on("project-changed",K)}),ke(()=>{te.off("project-changed",K)});const K=async()=>{console.log("Project changed event received, reloading warehouses..."),await E(),await G()},ae=async()=>{try{if(i.isInitialized||await i.initializeStore(),console.log("Mevcut depolar:",i.warehouses),i.warehouses.length===0){console.log("Test deposu ekleniyor...");const l={code:"DEPO01",name:"Test Depo",address:"Test Adres",manager:"Test Yönetici",isActive:!0};await i.addWarehouse(l),console.log("Test depo eklendi, veri tabanını kontrol edin."),await i.refreshData()}}catch(l){console.error("Test depo ekleme hatası:",l)}},E=async()=>{D.value=!0;try{i.isInitialized||await i.initializeStore(),console.log("Raw warehouses from store:",i.warehouses),i.activeProjectId&&i.projectWarehouses.length>0?(console.log("Using project warehouses:",i.projectWarehouses),p.value=[...i.projectWarehouses]):(console.log("Using all warehouses:",i.warehouses),p.value=[...i.warehouses]),p.value.length>0&&console.log("Sample warehouse data:",p.value[0])}catch(l){console.error("Depolar yüklenirken hata oluştu:",l)}finally{D.value=!1}},ne=()=>{h.value=!1,d.value={code:"",name:"",address:"",manager:"",isActive:!0,projectId:""},u.value={},W.value=!0},re=async l=>{h.value=!0,d.value={...l,address:l.address||"",manager:l.manager||"",projectId:""};try{const t=Ae(De(Pe,"projectWarehouses"),Ie("warehouseId","==",l.id)),r=await ze(t);if(!r.empty){const s=r.docs[0].data().projectId;d.value.projectId=s,console.log(`Depo (${l.id}) şu projeye atanmış: ${s}`)}}catch(t){console.error("Depo-proje ilişkisi yüklenirken hata oluştu:",t)}u.value={},W.value=!0},R=()=>{W.value=!1},ie=()=>(u.value={},d.value.code.trim()||(u.value.code="Depo kodu zorunludur"),d.value.name.trim()||(u.value.name="Depo adı zorunludur"),d.value.address.trim()||(u.value.address="Adres zorunludur"),d.value.manager.trim()||(u.value.manager="Sorumlu zorunludur"),Object.keys(u.value).length===0),ue=async()=>{if(ie()){U.value=!0;try{const l={...d.value};h.value&&l.id?await i.updateWarehouse(l.id,l):await i.addWarehouse(l),await E(),R()}catch(l){console.error("Depo kaydedilirken hata oluştu:",l)}finally{U.value=!1}}},de=async l=>{if(confirm("Bu depoyu silmek istediğinizden emin misiniz?")){D.value=!0;try{i.deleteWarehouse(l),p.value=i.getWarehouses}catch(t){console.error("Depo silinirken hata oluştu:",t)}finally{D.value=!1}}},ce=async l=>{B.value=l,V.value=!0,q.value=!0;try{const t=i.getStocksByWarehouseId(l.id);C.value=Array.isArray(t)?t.map(r=>{const s=i.products.find(f=>f.id===r.productId),v=r.projectId;return{...r,product:s||null,projectId:v}}):[]}catch(t){console.error("Stok durumu yüklenirken hata oluştu:",t)}finally{q.value=!1}},Y=()=>{V.value=!1,B.value=null,C.value=[],P.value="",k.value=""},ve=_(()=>{let l=C.value;if(k.value!==""&&(k.value==="null"?l=l.filter(t=>!t.projectId):l=l.filter(t=>t.projectId===k.value)),P.value){const t=P.value.toLowerCase();l=l.filter(r=>{var f,I;const s=((f=r.product)==null?void 0:f.name)||"",v=((I=r.product)==null?void 0:I.code)||"";return s.toLowerCase().includes(t)||v.toLowerCase().includes(t)})}return l}),me=l=>{var t;return(t=l.product)!=null&&t.minStockLevel?l.quantity>l.product.minStockLevel?"Normal":l.quantity===l.product.minStockLevel?"Kritik":"Düşük":"Belirsiz"},F=_(()=>{let l=[];if(y.isAdmin)l=[...i.warehouses],console.log("Admin kullanıcısı için tüm depolar gösteriliyor:",l.length);else{const s=y.getAuthorizedDepot||"";l=p.value.filter(v=>v.code===s)}const t=(x.value-1)*$.value,r=t+$.value;return l.slice(t,r)}),O=_(()=>{const l=y.getAuthorizedDepot||"",t=y.isAdmin?p.value.length:p.value.filter(r=>r.code===l).length;return Math.max(1,Math.ceil(t/$.value))}),j=c({}),G=async()=>{try{console.log("Loading warehouse-project relations...");const l=se();j.value={},await l.loadUserProjects();const t=l.projects;console.log("Projects fetched:",t.length);for(const r of t)try{const s=await xe.getWarehousesByProject(r.id);console.log(`Project ${r.name} has ${s.length} warehouses`);for(const v of s)j.value[v.id]||(j.value[v.id]=[]),j.value[v.id].push(r.name)}catch(s){console.error(`Error loading warehouses for project ${r.id}:`,s)}console.log("Final Warehouse-Project mappings:",j.value)}catch(l){console.error("Warehouse-project relations error:",l)}},H=l=>j.value[l]||[],pe=l=>{const t=L.value.find(r=>r.id===l);return t?t.name:"Bilinmeyen Proje"},be=async()=>{try{const l=se();await l.loadUserProjects(),L.value=l.projects}catch(l){console.error("Projeler yüklenirken hata oluştu:",l)}};return(l,t)=>{var r;return a(),o("div",null,[e("div",Te,[e("div",Ne,[t[11]||(t[11]=e("h5",{class:"font-semibold text-lg dark:text-white-light"},"Depolar",-1)),N.value?(a(),o("button",{key:0,class:"btn btn-primary",onClick:ne},[w(We,{class:"w-5 h-5 ltr:mr-2 rtl:ml-2"}),t[10]||(t[10]=g(" Yeni Depo Ekle "))])):m("",!0)]),e("div",Ue,[e("table",Ve,[t[14]||(t[14]=e("thead",null,[e("tr",null,[e("th",null,"Depo Kodu"),e("th",null,"Depo Adı"),e("th",null,"Lokasyon"),e("th",null,"Sorumlu"),e("th",null,"Proje"),e("th",null,"Durum"),e("th",null,"İşlemler")])],-1)),e("tbody",null,[D.value?(a(),o("tr",Be,t[12]||(t[12]=[e("td",{colspan:"7",class:"text-center"},[e("div",{class:"flex justify-center items-center p-4"},[e("div",{class:"animate-spin rounded-full h-6 w-6 border-2 border-primary border-l-transparent"})])],-1)]))):F.value.length===0?(a(),o("tr",qe,t[13]||(t[13]=[e("td",{colspan:"7",class:"text-center"},"Henüz depo bulunmamaktadır.",-1)]))):m("",!0),(a(!0),o(M,null,T(F.value,s=>(a(),o("tr",{key:s.id},[e("td",null,n(s.code),1),e("td",null,n(s.name),1),e("td",null,n(s.address),1),e("td",null,n(s.manager),1),e("td",null,[H(s.id).length>0?(a(),o("span",$e,n(H(s.id).join(", ")),1)):(a(),o("span",Ee,"Atanmamış"))]),e("td",null,[e("span",{class:S({"badge badge-success text-black":s.isActive,"badge badge-danger text-black":!s.isActive})},n(s.isActive?"Aktif":"Pasif"),3)]),e("td",null,[e("div",Re,[N.value?(a(),o("button",{key:0,class:"btn btn-sm btn-outline-primary",onClick:v=>re(s)},[w(Ce,{class:"w-4.5 h-4.5"})],8,Ke)):m("",!0),N.value?(a(),o("button",{key:1,class:"btn btn-sm btn-outline-danger",onClick:v=>de(s.id)},[w(Le,{class:"w-4.5 h-4.5"})],8,Ye)):m("",!0),e("button",{class:"btn btn-sm btn-outline-info",onClick:v=>ce(s)},[w(Me,{class:"w-4.5 h-4.5"})],8,Fe)])])]))),128))])])]),e("div",Oe,[e("p",Ge,"Toplam: "+n(p.value.length)+" depo",1),e("div",He,[e("button",{class:"btn btn-sm btn-outline-primary",disabled:x.value===1,onClick:t[0]||(t[0]=s=>x.value--)}," Önceki ",8,Je),e("span",Qe,n(x.value)+" / "+n(O.value),1),e("button",{class:"btn btn-sm btn-outline-primary",disabled:x.value===O.value,onClick:t[1]||(t[1]=s=>x.value++)}," Sonraki ",8,Xe)])])]),W.value?(a(),o("div",Ze,[e("div",et,[e("div",tt,[e("h5",st,n(h.value?"Depo Düzenle":"Yeni Depo Ekle"),1),e("button",{class:"text-gray-400 hover:text-gray-800",onClick:R},[w(oe,{class:"w-5 h-5"})])]),e("form",{onSubmit:je(ue,["prevent"])},[e("div",lt,[e("div",ot,[t[15]||(t[15]=e("label",null,[g("Depo Kodu "),e("span",{class:"text-red-500"},"*")],-1)),b(e("input",{type:"text",class:S(["form-input",{"border-red-500":u.value.code}]),"onUpdate:modelValue":t[2]||(t[2]=s=>d.value.code=s),required:"",readonly:h.value},null,10,at),[[z,d.value.code]]),u.value.code?(a(),o("p",nt,n(u.value.code),1)):m("",!0)]),e("div",rt,[t[16]||(t[16]=e("label",null,[g("Depo Adı "),e("span",{class:"text-red-500"},"*")],-1)),b(e("input",{type:"text",class:S(["form-input",{"border-red-500":u.value.name}]),"onUpdate:modelValue":t[3]||(t[3]=s=>d.value.name=s),required:""},null,2),[[z,d.value.name]]),u.value.name?(a(),o("p",it,n(u.value.name),1)):m("",!0)]),e("div",ut,[t[17]||(t[17]=e("label",null,[g("Lokasyon "),e("span",{class:"text-red-500"},"*")],-1)),b(e("textarea",{class:S(["form-textarea",{"border-red-500":u.value.address}]),rows:"3","onUpdate:modelValue":t[4]||(t[4]=s=>d.value.address=s),required:""},null,2),[[z,d.value.address]]),u.value.address?(a(),o("p",dt,n(u.value.address),1)):m("",!0)]),e("div",ct,[t[18]||(t[18]=e("label",null,[g("Sorumlu Firma "),e("span",{class:"text-red-500"},"*")],-1)),b(e("input",{type:"text",class:S(["form-input",{"border-red-500":u.value.manager}]),"onUpdate:modelValue":t[5]||(t[5]=s=>d.value.manager=s),required:""},null,2),[[z,d.value.manager]]),u.value.manager?(a(),o("p",vt,n(u.value.manager),1)):m("",!0)]),e("div",mt,[t[20]||(t[20]=e("label",null,"Durum",-1)),e("div",pt,[e("label",bt,[b(e("input",{type:"checkbox",class:"form-checkbox","onUpdate:modelValue":t[6]||(t[6]=s=>d.value.isActive=s)},null,512),[[_e,d.value.isActive]]),t[19]||(t[19]=e("span",null,"Aktif",-1))])])]),e("div",ft,[t[22]||(t[22]=e("label",null,"Proje",-1)),b(e("select",{class:"form-select","onUpdate:modelValue":t[7]||(t[7]=s=>d.value.projectId=s)},[t[21]||(t[21]=e("option",{value:""},"Proje Seçin (Opsiyonel)",-1)),(a(!0),o(M,null,T(L.value,s=>(a(),o("option",{key:s.id,value:s.id},n(s.name),9,gt))),128))],512),[[le,d.value.projectId]]),t[23]||(t[23]=e("p",{class:"text-xs mt-1 text-gray-500"}," Depoyu bir projeyle ilişkilendirmek isterseniz seçebilirsiniz. ",-1))])]),e("div",yt,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:R}," İptal "),e("button",{type:"submit",class:"btn btn-primary",disabled:U.value},n(h.value?"Güncelle":"Ekle"),9,ht)])],32)])])):m("",!0),V.value?(a(),o("div",kt,[e("div",xt,[e("div",jt,[e("h5",_t,n((r=B.value)==null?void 0:r.name)+" - Stok Durumu",1),e("button",{class:"text-gray-400 hover:text-gray-800",onClick:Y},[w(oe,{class:"w-5 h-5"})])]),t[30]||(t[30]=g()),e("div",wt,[e("div",St,[b(e("input",{type:"text",class:"form-input","onUpdate:modelValue":t[8]||(t[8]=s=>P.value=s),placeholder:"Ürün Ara..."},null,512),[[z,P.value]])]),e("div",At,[b(e("select",{class:"form-select","onUpdate:modelValue":t[9]||(t[9]=s=>k.value=s)},[t[24]||(t[24]=e("option",{value:""},"Tüm Projeler",-1)),(a(!0),o(M,null,T(L.value,s=>(a(),o("option",{key:s.id,value:s.id},n(s.name),9,Dt))),128)),t[25]||(t[25]=e("option",{value:"null"},"Atanmamış",-1))],512),[[le,k.value]])])]),e("div",Pt,[e("table",It,[t[29]||(t[29]=e("thead",null,[e("tr",null,[e("th",null,"Ürün Kodu"),e("th",null,"Ürün Adı"),e("th",null,"Proje"),e("th",null,"Miktar"),e("th",null,"Birim"),e("th",null,"Min. Stok"),e("th",null,"Durum")])],-1)),e("tbody",null,[q.value?(a(),o("tr",zt,t[26]||(t[26]=[e("td",{colspan:"7",class:"text-center"},[e("div",{class:"flex justify-center items-center p-4"},[e("div",{class:"animate-spin rounded-full h-6 w-6 border-2 border-primary border-l-transparent"})])],-1)]))):C.value.length===0?(a(),o("tr",Wt,t[27]||(t[27]=[e("td",{colspan:"7",class:"text-center"},"Bu depoda ürün bulunmamaktadır.",-1)]))):m("",!0),(a(!0),o(M,null,T(ve.value,s=>{var v,f,I,J,Q,X,Z,ee;return a(),o("tr",{key:s.productId},[e("td",null,n(((v=s.product)==null?void 0:v.code)||"N/A"),1),e("td",null,n(((f=s.product)==null?void 0:f.name)||"N/A"),1),t[28]||(t[28]=g()),e("td",null,[s.projectId?(a(),o("span",Ct,n(pe(s.projectId)),1)):s.projectId==="ApMkLHJ3Rk7BpmYuNm5Z"?(a(),o("span",Lt," KGYS ")):(a(),o("span",Mt,"Atanmamış"))]),e("td",null,n(s.quantity),1),e("td",null,n(((I=s.product)==null?void 0:I.unit)||"N/A"),1),e("td",null,n(((J=s.product)==null?void 0:J.minStockLevel)||0),1),e("td",null,[e("span",{class:S({"badge badge-success text-black":((Q=s.product)==null?void 0:Q.minStockLevel)&&s.quantity>s.product.minStockLevel,"badge badge-warning text-black":((X=s.product)==null?void 0:X.minStockLevel)&&s.quantity===s.product.minStockLevel,"badge badge-danger text-black":((Z=s.product)==null?void 0:Z.minStockLevel)&&s.quantity<s.product.minStockLevel,"badge badge-info text-black":!((ee=s.product)!=null&&ee.minStockLevel)})},n(me(s)),3)])])}),128))])])]),e("div",{class:"flex justify-end mt-6"},[e("button",{class:"btn btn-outline-primary",onClick:Y}," Kapat ")])])])):m("",!0)])}}});export{Et as default};
