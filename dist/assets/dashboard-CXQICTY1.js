import{y as I,ad as D,l as T,r as z,m as b,t as B,c as u,a as t,O as d,I as C,J as M,d as j,S as A,U as P,Q as V,o as c,e as L,V as q}from"./index-CMVsiJL9.js";const N={class:"panel"},H={class:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6 mb-6"},E={class:"panel bg-gradient-to-r from-blue-500 to-blue-400"},F={class:"flex justify-between"},G={class:"text-white"},O={class:"text-2xl font-semibold"},J={class:"panel bg-gradient-to-r from-green-500 to-green-400"},K={class:"flex justify-between"},Q={class:"text-white"},R={class:"text-2xl font-semibold"},U={class:"panel bg-gradient-to-r from-orange-500 to-orange-400"},Y={class:"flex justify-between"},X={class:"text-white"},Z={key:0,class:"text-2xl font-semibold"},$={key:1,class:"text-2xl font-semibold"},tt={class:"font-semibold mb-0"},et={class:"grid grid-cols-1 gap-6 mb-6"},st={class:"panel h-full"},ot={class:"flex items-center justify-between mb-5"},rt={class:"table-responsive"},at={class:"table-striped"},it={key:0},nt={key:1},dt={key:0},lt={key:1},ht=I({__name:"dashboard",setup(ut){const r=D(),h=T(),y=z(!0),g=b(()=>{if(h.isAdmin)return r.getDashboardStats;const a=h.getAuthorizedDepot;if(!a)return r.getDashboardStats;const e=r.getWarehouses.find(i=>i.code===a);if(!e)return r.getDashboardStats;const f=r.stocks.filter(i=>i.warehouseId===e.id),s=[...new Set(f.map(i=>i.productId))],o=f.filter(i=>{const l=r.getProducts.find(p=>p.id===i.productId);return l&&i.quantity<=l.minStockLevel});return{totalProducts:s.length,totalCategories:r.getCategories.length,totalWarehouses:e.name,lowStockCount:o.length,warehouseId:e.id}}),_=b(()=>{const a=r.getMovements;if(h.isAdmin)return a.slice(0,5).map(s=>({...s,product:r.getProducts.find(o=>o.id===s.productId),sourceWarehouse:r.getWarehouses.find(o=>o.id===s.sourceWarehouseId),targetWarehouse:s.targetWarehouseId?r.getWarehouses.find(o=>o.id===s.targetWarehouseId):void 0}));const e=h.getAuthorizedDepot;return e?a.filter(s=>{const o=r.getWarehouses.find(l=>l.id===s.sourceWarehouseId),i=s.targetWarehouseId?r.getWarehouses.find(l=>l.id===s.targetWarehouseId):void 0;return(o==null?void 0:o.code)===e||(i==null?void 0:i.code)===e}).slice(0,5).map(s=>({...s,product:r.getProducts.find(o=>o.id===s.productId),sourceWarehouse:r.getWarehouses.find(o=>o.id===s.sourceWarehouseId),targetWarehouse:s.targetWarehouseId?r.getWarehouses.find(o=>o.id===s.targetWarehouseId):void 0})):[]});b(()=>{if(h.isAdmin)return r.getLowStockProducts;const a=h.getAuthorizedDepot;if(!a)return[];const e=r.getWarehouses.find(s=>s.code===a);return e?r.getStocksByWarehouseId(e.id).map(s=>{const o=r.getProducts.find(i=>i.id===s.productId);return!o||s.quantity>o.minStockLevel?null:{...o,totalStock:s.quantity}}).filter(s=>s!=null):[]}),B(async()=>{try{await r.initializeStore()}catch(a){console.error("Veri yükleme hatası:",a)}finally{setTimeout(()=>{y.value=!1},300)}});const v=a=>{if(!a)return"";try{const e=typeof a=="string"?new Date(a):a;return new Intl.DateTimeFormat("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(e)}catch(e){return console.error("Tarih formatlarken hata:",e),""}},S=a=>{switch(a){case"in":return"Giriş";case"out":return"Çıkış";case"transfer":return"Transfer";case"stock_add":return"Stok Ekleme";default:return a||"Bilinmiyor"}};return(a,e)=>{var s,o,i,l,p,x,m;const f=V("router-link");return c(),u("div",null,[t("div",N,[e[10]||(e[10]=t("div",{class:"flex items-center justify-between mb-5"},[t("h5",{class:"font-semibold text-lg dark:text-white-light"},"Stok Yönetimi Dashboard")],-1)),t("div",H,[t("div",E,[t("div",F,[t("div",G,[t("h5",O,d(((s=g.value)==null?void 0:s.totalProducts)||0),1),e[0]||(e[0]=t("h6",{class:"font-semibold mb-0"},"Toplam Ürün",-1))]),e[1]||(e[1]=t("div",{class:"text-white"},[t("i",{class:"las la-box text-4xl"})],-1))])]),t("div",J,[t("div",K,[t("div",Q,[t("h5",R,d(((o=g.value)==null?void 0:o.totalCategories)||0),1),e[2]||(e[2]=t("h6",{class:"font-semibold mb-0"},"Toplam Kategori",-1))]),e[3]||(e[3]=t("div",{class:"text-white"},[t("i",{class:"las la-tags text-4xl"})],-1))])]),t("div",U,[t("div",Y,[t("div",X,[typeof((i=g.value)==null?void 0:i.totalWarehouses)=="number"?(c(),u("h5",Z,d(((l=g.value)==null?void 0:l.totalWarehouses)||0),1)):(c(),u("h5",$,d((p=g.value)==null?void 0:p.totalWarehouses),1)),t("h6",tt,d(typeof((x=g.value)==null?void 0:x.totalWarehouses)=="number"?"Toplam Depo":"Depo"),1)]),e[4]||(e[4]=t("div",{class:"text-white"},[t("i",{class:"las la-warehouse text-4xl"})],-1))])])]),t("div",et,[t("div",st,[t("div",ot,[e[6]||(e[6]=t("h5",{class:"font-semibold text-lg dark:text-white-light"},"Son Stok Hareketleri",-1)),C(f,{to:"/inventory/movements",class:"text-primary hover:underline"},{default:M(()=>e[5]||(e[5]=[L(" Tümünü Gör ")])),_:1})]),t("div",rt,[t("table",at,[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",null,"Tarih"),t("th",null,"Ürün"),t("th",null,"Hareket Türü"),t("th",null,"Miktar"),t("th",null,"Depo")])],-1)),t("tbody",null,[y.value?(c(),u("tr",it,e[7]||(e[7]=[t("td",{colspan:"5",class:"text-center"},[t("div",{class:"flex justify-center items-center p-4"},[t("div",{class:"animate-spin rounded-full h-6 w-6 border-2 border-primary border-l-transparent"})])],-1)]))):(m=_.value)!=null&&m.length?j("",!0):(c(),u("tr",nt,e[8]||(e[8]=[t("td",{colspan:"5",class:"text-center"},"Henüz hareket kaydı bulunmamaktadır.",-1)]))),(c(!0),u(A,null,P(_.value,n=>{var k,W,w;return c(),u("tr",{key:n.id},[t("td",null,d(v(n.date)),1),t("td",null,d(((k=n.product)==null?void 0:k.name)||"Bilinmiyor"),1),t("td",null,[t("span",{class:q({"badge badge-success":n.type==="in","badge badge-danger":n.type==="out","badge badge-info":n.type==="transfer"})},d(S(n.type)),3)]),t("td",null,d(n.quantity)+" "+d(((W=n.product)==null?void 0:W.unit)||"adet"),1),t("td",null,[n.type==="transfer"&&n.sourceWarehouse&&n.targetWarehouse?(c(),u("span",dt,d(n.sourceWarehouse.name||"Bilinmiyor")+" → "+d(n.targetWarehouse.name||"Bilinmiyor"),1)):(c(),u("span",lt,d(((w=n.sourceWarehouse)==null?void 0:w.name)||"Bilinmiyor"),1))])])}),128))])])])])])])])}}});export{ht as default};
