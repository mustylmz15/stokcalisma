import{d as de,A as ue,Q as ce,r as b,y as M,k as N,a as me,R as V,f as a,i as t,q as v,H as h,s as w,K as x,L as A,S as R,G as u,D as T,E as f,F,J as be,T as H,U,e as n,M as q}from"./index-C3vCaKLz.js";const pe={class:"panel"},ve={class:"flex mb-5 justify-between"},fe={class:"flex items-center"},ye={key:0,class:"animate-spin border-2 border-primary border-l-transparent rounded-full w-5 h-5 inline-block align-middle"},ke={key:0},ge={class:"table-responsive"},he={class:"table-striped"},je={class:"font-semibold"},we={class:"flex items-center gap-2"},Pe=["onClick"],xe=["onClick"],Ae=["onClick"],_e=["onClick"],ze={key:1,class:"text-center py-8"},Ie={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},De={class:"panel w-11/12 sm:w-3/4 md:w-2/3 lg:w-1/2 max-h-[90vh] overflow-y-auto"},Ue={class:"flex justify-between items-center mb-5"},$e={class:"font-semibold text-lg"},Ce={class:"mb-5"},Ee={class:"mb-5"},Ke={class:"mb-5"},Se={class:"mb-5"},We={class:"inline-flex"},Me={class:"flex justify-end gap-4 mt-8"},Ve=["disabled"],Re={key:0,class:"animate-spin border-2 border-white border-l-transparent rounded-full w-4 h-4 inline-block align-middle ml-2"},Te={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},Fe={class:"panel w-11/12 sm:w-3/4 md:w-2/3 lg:w-1/2 max-h-[90vh] overflow-y-auto"},He={class:"flex justify-between items-center mb-5"},Be={class:"font-semibold text-lg"},Ne={class:"mb-5 border-b pb-5"},qe={class:"grid grid-cols-1 sm:grid-cols-3 gap-4"},Ge=["value"],Oe={class:"flex items-end"},Ye=["disabled"],Le={key:0,class:"animate-spin border-2 border-white border-l-transparent rounded-full w-4 h-4 inline-block align-middle ml-2"},Je={key:0},Qe={class:"table-responsive"},Xe={class:"table-striped"},Ze=["onUpdate:modelValue","onChange"],et=["onClick","disabled"],tt={key:1,class:"text-center py-5"},lt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},st={class:"panel w-11/12 sm:w-3/4 md:w-2/3 lg:w-1/2 max-h-[90vh] overflow-y-auto"},ot={class:"flex justify-between items-center mb-5"},nt={class:"font-semibold text-lg"},at={class:"mb-5 border-b pb-5"},it={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},rt=["value"],dt={class:"flex items-end"},ut=["disabled"],ct={key:0,class:"animate-spin border-2 border-white border-l-transparent rounded-full w-4 h-4 inline-block align-middle ml-2"},mt={key:0},bt={class:"table-responsive"},pt={class:"table-striped"},vt=["onClick"],ft={key:1,class:"text-center py-5"},gt=de({__name:"projeler",setup(yt){const $=ue(),d=ce(),P=b(!1),C=b(!1),E=b(!1),_=b("add"),r=b(null),o=M({id:"",name:"",description:"",managerEmail:"",isActive:!0}),c=M({userId:"",role:"user"}),j=M({warehouseId:""}),y=b([]),z=b([]),k=b([]),I=b([]),B=b(!1),G=N(()=>{const s=y.value.map(e=>e.id);return z.value.filter(e=>!s.includes(e.id))}),O=N(()=>{const s=k.value.map(e=>e.id);return I.value.filter(e=>!s.includes(e.id))});me(async()=>{try{d.isInitialized||(await d.initializeStore(),console.log("Project store başarıyla başlatıldı")),await Y(),await L()}catch(s){console.error("Sayfa yüklenirken hata:",s),i("Veriler yüklenirken hata oluştu","error")}});async function Y(){try{z.value=await $.getAllUsers(),console.log(`${z.value.length} kullanıcı yüklendi`)}catch(s){console.error("Kullanıcılar yüklenirken hata:",s),i("Kullanıcılar yüklenirken hata oluştu","error")}}async function L(){try{I.value=await V.getAllWarehouses(),console.log(`${I.value.length} depo yüklendi`)}catch(s){console.error("Depolar yüklenirken hata:",s),i("Depolar yüklenirken hata oluştu","error")}}function K(s,e){_.value=s,s==="add"?(o.id="",o.name="",o.description="",o.managerEmail="",o.isActive=!0):s==="edit"&&e&&(o.id=e.id,o.name=e.name,o.description=e.description||"",o.managerEmail=e.managerEmail||"",o.isActive=e.isActive!==void 0?e.isActive:!0),P.value=!0}async function J(){try{_.value==="add"?(await d.addProject({name:o.name,description:o.description,managerEmail:o.managerEmail,isActive:o.isActive}),i("Proje başarıyla oluşturuldu","success")):(await d.updateProject(o.id,{name:o.name,description:o.description,managerEmail:o.managerEmail,isActive:o.isActive}),i("Proje başarıyla güncellendi","success")),P.value=!1}catch(s){i(`Hata: ${s.message||"İşlem başarısız"}`,"error")}}function Q(s){confirm(`"${s.name}" projesini silmek istediğinize emin misiniz?`)&&X(s.id)}async function X(s){try{await d.deleteProject(s),i("Proje başarıyla silindi","success")}catch(e){i(`Hata: ${e.message||"İşlem başarısız"}`,"error")}}async function Z(s){r.value=s,C.value=!0,c.userId="",c.role="user",await D(s.id)}async function D(s){try{const e=await V.getUsersByProjectId(s);y.value=[];for(const m of e){const p=z.value.find(l=>l.id===m.userId);p&&y.value.push({...p,projectRole:m.role})}console.log(`${y.value.length} kullanıcı projede bulunuyor`)}catch(e){console.error("Proje kullanıcıları yüklenirken hata:",e),i("Kullanıcılar yüklenirken hata oluştu","error"),y.value=[]}}async function ee(){if(!(!r.value||!c.userId))try{await d.addUserToProject(c.userId,r.value.id,c.role),await D(r.value.id),c.userId="",i("Kullanıcı projeye eklendi","success")}catch(s){i(`Hata: ${s.message||"İşlem başarısız"}`,"error")}}async function te(s,e){if(r.value)try{await d.updateUserProjectRole(s,r.value.id,e),i("Kullanıcı rolü güncellendi","success")}catch(m){i(`Hata: ${m.message||"İşlem başarısız"}`,"error"),await D(r.value.id)}}function le(s){var e;if(s.id===((e=$.userInfo)==null?void 0:e.id)){i("Kendi kullanıcınızı projeden çıkaramazsınız","error");return}confirm(`"${s.name}" kullanıcısını projeden çıkarmak istediğinize emin misiniz?`)&&se(s.id)}async function se(s){if(r.value)try{await d.removeUserFromProject(s,r.value.id),await D(r.value.id),i("Kullanıcı projeden çıkarıldı","success")}catch(e){i(`Hata: ${e.message||"İşlem başarısız"}`,"error")}}async function oe(s){r.value=s,E.value=!0,j.warehouseId="",await S(s.id)}async function S(s){try{const e=await V.getWarehousesByProjectId(s);k.value=[];for(const m of e){const p=I.value.find(l=>l.id===m.warehouseId);p&&k.value.push({...p,isActive:m.isActive})}console.log(`${k.value.length} depo projede bulunuyor`)}catch(e){console.error("Proje depoları yüklenirken hata:",e),i("Depolar yüklenirken hata oluştu","error"),k.value=[]}}async function ne(){if(!(!r.value||!j.warehouseId))try{await d.addWarehouseToProject(j.warehouseId,r.value.id),await S(r.value.id),j.warehouseId="",i("Depo projeye eklendi","success")}catch(s){i(`Hata: ${s.message||"İşlem başarısız"}`,"error")}}function ae(s){confirm(`"${s.name}" deposunu projeden çıkarmak istediğinize emin misiniz?`)&&ie(s.id)}async function ie(s){if(r.value)try{await d.removeWarehouseFromProject(s,r.value.id),await S(r.value.id),i("Depo projeden çıkarıldı","success")}catch(e){i(`Hata: ${e.message||"İşlem başarısız"}`,"error")}}function re(s){try{const e=new Date(s);return new Intl.DateTimeFormat("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)}catch(e){return console.error("Tarih formatlanırken hata:",e),s}}function i(s,e="success"){alert(s)}return(s,e)=>{var m,p;return n(),a("div",null,[t("div",pe,[t("div",ve,[t("div",fe,[e[13]||(e[13]=t("h5",{class:"font-semibold text-lg dark:text-white-light mr-2"},"Proje Yönetimi",-1)),v(d).loading?(n(),a("span",ye)):h("",!0)]),t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=l=>K("add"))},e[14]||(e[14]=[t("span",{class:"material-icons-outlined",add:""},null,-1),w(" Yeni Proje ")]))]),v(d).projects.length>0?(n(),a("div",ke,[t("div",ge,[t("table",he,[e[19]||(e[19]=t("thead",null,[t("tr",null,[t("th",null,"Proje Adı"),t("th",null,"Açıklama"),t("th",null,"Oluşturulma Tarihi"),t("th",null,"Durum"),t("th",null,"İşlemler")])],-1)),t("tbody",null,[(n(!0),a(x,null,A(v(d).projects,l=>(n(),a("tr",{key:l.id},[t("td",je,u(l.name),1),t("td",null,u(l.description||"-"),1),t("td",null,u(re(l.createdAt)),1),t("td",null,[t("span",{class:q({"badge badge-outline-success":l.isActive,"badge badge-outline-danger":!l.isActive})},u(l.isActive?"Aktif":"Pasif"),3)]),t("td",null,[t("div",we,[t("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:g=>K("edit",l)},e[15]||(e[15]=[t("span",{class:"material-icons-outlined text-sm"},"edit",-1)]),8,Pe),t("button",{type:"button",class:"btn btn-sm btn-outline-info",onClick:g=>Z(l)},e[16]||(e[16]=[t("span",{class:"material-icons-outlined text-sm"},"people",-1)]),8,xe),t("button",{type:"button",class:"btn btn-sm btn-outline-success",onClick:g=>oe(l)},e[17]||(e[17]=[t("span",{class:"material-icons-outlined text-sm"},"warehouse",-1)]),8,Ae),t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:g=>Q(l)},e[18]||(e[18]=[t("span",{class:"material-icons-outlined text-sm"},"delete",-1)]),8,_e)])])]))),128))])])])])):(n(),a("div",ze,[e[21]||(e[21]=t("div",{class:"text-gray-400 mb-4"},[t("span",{class:"material-icons-outlined text-6xl"},"folder_open")],-1)),e[22]||(e[22]=t("p",null,"Henüz hiç proje oluşturulmamış.",-1)),t("button",{type:"button",class:"btn btn-primary mt-4",onClick:e[1]||(e[1]=l=>K("add"))},e[20]||(e[20]=[t("span",{class:"material-icons-outlined"},"add",-1),w(" İlk Projeyi Oluştur ")]))]))]),(n(),R(H,{to:"body"},[P.value?(n(),a("div",Ie,[t("div",De,[t("div",Ue,[t("h5",$e,u(_.value==="add"?"Yeni Proje Oluştur":"Projeyi Düzenle"),1),t("button",{type:"button",class:"text-gray-400 hover:text-gray-800",onClick:e[2]||(e[2]=l=>P.value=!1)},e[23]||(e[23]=[t("span",{class:"material-icons-outlined"},"close",-1)]))]),t("form",{onSubmit:T(J,["prevent"])},[t("div",Ce,[e[24]||(e[24]=t("label",{for:"name",class:"form-label"},[w("Proje Adı "),t("span",{class:"text-danger"},"*")],-1)),f(t("input",{id:"name",type:"text",class:"form-input","onUpdate:modelValue":e[3]||(e[3]=l=>o.name=l),placeholder:"Proje Adı",required:""},null,512),[[F,o.name]])]),t("div",Ee,[e[25]||(e[25]=t("label",{for:"description",class:"form-label"},"Açıklama",-1)),f(t("textarea",{id:"description",class:"form-textarea","onUpdate:modelValue":e[4]||(e[4]=l=>o.description=l),placeholder:"Proje açıklaması"},null,512),[[F,o.description]])]),t("div",Ke,[e[26]||(e[26]=t("label",{for:"managerEmail",class:"form-label"},"Proje Yöneticisi Email",-1)),f(t("input",{id:"managerEmail",type:"email",class:"form-input","onUpdate:modelValue":e[5]||(e[5]=l=>o.managerEmail=l),placeholder:"ornek@firma.com"},null,512),[[F,o.managerEmail]])]),t("div",Se,[t("label",We,[f(t("input",{type:"checkbox",class:"form-checkbox","onUpdate:modelValue":e[6]||(e[6]=l=>o.isActive=l)},null,512),[[be,o.isActive]]),e[27]||(e[27]=t("span",null,"Aktif",-1))])]),t("div",Me,[t("button",{type:"button",class:"btn btn-outline-danger",onClick:e[7]||(e[7]=l=>P.value=!1)},"İptal"),t("button",{type:"submit",class:"btn btn-primary",disabled:v(d).loading},[w(u(_.value==="add"?"Oluştur":"Güncelle")+" ",1),v(d).loading?(n(),a("span",Re)):h("",!0)],8,Ve)])],32)])])):h("",!0)])),(n(),R(H,{to:"body"},[C.value?(n(),a("div",Te,[t("div",Fe,[t("div",He,[t("h5",Be,"Proje Kullanıcıları: "+u((m=r.value)==null?void 0:m.name),1),t("button",{type:"button",class:"text-gray-400 hover:text-gray-800",onClick:e[8]||(e[8]=l=>C.value=!1)},e[28]||(e[28]=[t("span",{class:"material-icons-outlined"},"close",-1)]))]),t("div",Ne,[e[34]||(e[34]=t("h6",{class:"font-semibold mb-3"},"Kullanıcı Ekle",-1)),t("form",{onSubmit:T(ee,["prevent"])},[t("div",qe,[t("div",null,[e[30]||(e[30]=t("label",{for:"userId",class:"form-label"},"Kullanıcı",-1)),f(t("select",{id:"userId",class:"form-select","onUpdate:modelValue":e[9]||(e[9]=l=>c.userId=l),required:""},[e[29]||(e[29]=t("option",{value:"",disabled:"",selected:""},"Kullanıcı Seçin",-1)),(n(!0),a(x,null,A(G.value,l=>(n(),a("option",{key:l.id,value:l.id},u(l.name)+" ("+u(l.email)+") ",9,Ge))),128))],512),[[U,c.userId]])]),t("div",null,[e[32]||(e[32]=t("label",{for:"role",class:"form-label"},"Rol",-1)),f(t("select",{id:"role",class:"form-select","onUpdate:modelValue":e[10]||(e[10]=l=>c.role=l),required:""},e[31]||(e[31]=[t("option",{value:"admin"},"Admin",-1),t("option",{value:"proje_admin"},"Proje Admin",-1),t("option",{value:"user"},"Normal Kullanıcı",-1),t("option",{value:"observer"},"Gözlemci",-1),t("option",{value:"depo_sorumlusu"},"Depo Sorumlusu",-1)]),512),[[U,c.role]])]),t("div",Oe,[t("button",{type:"submit",class:"btn btn-primary w-full",disabled:v(d).loading},[e[33]||(e[33]=w(" Ekle ")),v(d).loading?(n(),a("span",Le)):h("",!0)],8,Ye)])])],32)]),y.value.length>0?(n(),a("div",Je,[e[38]||(e[38]=t("h6",{class:"font-semibold mb-3"},"Proje Kullanıcıları",-1)),t("div",Qe,[t("table",Xe,[e[37]||(e[37]=t("thead",null,[t("tr",null,[t("th",null,"Kullanıcı"),t("th",null,"E-posta"),t("th",null,"Rol"),t("th",null,"İşlemler")])],-1)),t("tbody",null,[(n(!0),a(x,null,A(y.value,l=>{var g;return n(),a("tr",{key:l.id},[t("td",null,u(l.name),1),t("td",null,u(l.email),1),t("td",null,[f(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":W=>l.projectRole=W,onChange:W=>te(l.id,l.projectRole||"user")},e[35]||(e[35]=[t("option",{value:"admin"},"Admin",-1),t("option",{value:"proje_admin"},"Proje Admin",-1),t("option",{value:"user"},"Normal Kullanıcı",-1),t("option",{value:"observer"},"Gözlemci",-1),t("option",{value:"depo_sorumlusu"},"Depo Sorumlusu",-1)]),40,Ze),[[U,l.projectRole]])]),t("td",null,[t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:W=>le(l),disabled:l.id===((g=v($).userInfo)==null?void 0:g.id)},e[36]||(e[36]=[t("span",{class:"material-icons-outlined text-sm"},"person_remove",-1)]),8,et)])])}),128))])])])])):(n(),a("div",tt,e[39]||(e[39]=[t("p",null,"Bu projede henüz kullanıcı bulunmuyor.",-1)])))])])):h("",!0)])),(n(),R(H,{to:"body"},[E.value?(n(),a("div",lt,[t("div",st,[t("div",ot,[t("h5",nt,"Proje Depoları: "+u((p=r.value)==null?void 0:p.name),1),t("button",{type:"button",class:"text-gray-400 hover:text-gray-800",onClick:e[11]||(e[11]=l=>E.value=!1)},e[40]||(e[40]=[t("span",{class:"material-icons-outlined"},"close",-1)]))]),t("div",at,[e[44]||(e[44]=t("h6",{class:"font-semibold mb-3"},"Depo Ekle",-1)),t("form",{onSubmit:T(ne,["prevent"])},[t("div",it,[t("div",null,[e[42]||(e[42]=t("label",{for:"warehouseId",class:"form-label"},"Depo",-1)),f(t("select",{id:"warehouseId",class:"form-select","onUpdate:modelValue":e[12]||(e[12]=l=>j.warehouseId=l),required:""},[e[41]||(e[41]=t("option",{value:"",disabled:"",selected:""},"Depo Seçin",-1)),(n(!0),a(x,null,A(O.value,l=>(n(),a("option",{key:l.id,value:l.id},u(l.name)+" ("+u(l.code)+") ",9,rt))),128))],512),[[U,j.warehouseId]])]),t("div",dt,[t("button",{type:"submit",class:"btn btn-primary w-full",disabled:B.value},[e[43]||(e[43]=w(" Ekle ")),B.value?(n(),a("span",ct)):h("",!0)],8,ut)])])],32)]),k.value.length>0?(n(),a("div",mt,[e[47]||(e[47]=t("h6",{class:"font-semibold mb-3"},"Projeye Atanmış Depolar",-1)),t("div",bt,[t("table",pt,[e[46]||(e[46]=t("thead",null,[t("tr",null,[t("th",null,"Depo Kodu"),t("th",null,"Depo Adı"),t("th",null,"Durum"),t("th",null,"İşlemler")])],-1)),t("tbody",null,[(n(!0),a(x,null,A(k.value,l=>(n(),a("tr",{key:l.id},[t("td",null,u(l.code),1),t("td",null,u(l.name),1),t("td",null,[t("span",{class:q({"badge badge-outline-success":l.isActive,"badge badge-outline-danger":!l.isActive})},u(l.isActive?"Aktif":"Pasif"),3)]),t("td",null,[t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:g=>ae(l)},e[45]||(e[45]=[t("span",{class:"material-icons-outlined text-sm"},"delete",-1)]),8,vt)])]))),128))])])])])):(n(),a("div",ft,e[48]||(e[48]=[t("p",null,"Bu projede henüz depo bulunmuyor.",-1)])))])])):h("",!0)]))])}}});export{gt as default};
