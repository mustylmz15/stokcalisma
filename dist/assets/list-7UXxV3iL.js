import{y as Z,l as q,ad as G,a5 as ee,m as y,r as m,t as te,ah as M,ai as oe,c as l,a as e,M as T,a7 as E,S as V,U as $,N as se,a6 as g,J as D,d as c,O as a,e as _,I,V as U,Q as ne,o as n,a3 as K,ab as le,aj as re}from"./index-CMVsiJL9.js";import{I as ae}from"./icon-plus-BXC3-OCg.js";import{_ as ie}from"./icon-pencil.vue_vue_type_script_setup_true_lang-pNE-cN8a.js";import{I as ue}from"./icon-trash-lines-4s8JVsKe.js";import{I as ce}from"./icon-x-C5nNggym.js";import{I as R,a as de}from"./icon-info-triangle-ZmNT3ayS.js";const me={class:"panel"},ve={class:"flex flex-col md:flex-row items-center justify-between mb-5"},fe={class:"flex flex-col md:flex-row gap-4 w-full md:w-auto mt-4 md:mt-0"},pe={class:"flex flex-col md:flex-row gap-4"},ye={class:"flex-1 md:w-48"},he=["value"],ge={class:"flex-1"},ke={class:"flex gap-2"},be={key:0},we={key:1},xe={class:"table-responsive"},_e={class:"table-striped"},Ie={key:0},Se={key:1},Ce={colspan:"8",class:"text-center"},Pe={class:"flex gap-2"},je=["onClick"],Te={key:2,class:"text-sm text-gray-500 italic"},De={class:"flex items-center justify-between mt-5"},ze={class:"flex items-center gap-2"},Le={class:"flex items-center gap-2"},Be=["disabled"],Ne=["disabled"],Ae={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},Me={class:"panel bg-white dark:bg-gray-800 w-full max-w-md"},Ee={class:"flex flex-col items-center mb-5"},Ve={class:"text-red-500 p-4"},$e={class:"text-center"},Ue={class:"flex justify-center gap-4"},Ke=["disabled"],Re={key:0,class:"animate-spin mr-2"},Ye={class:"flex items-center gap-2"},Ze=Z({__name:"list",setup(Oe){const C=q(),d=G(),Y=ee(),z=y(()=>{try{return K().isAdmin()}catch(o){return console.warn("Rol servisi erişilemedi, authStore kullanılıyor",o),C.isAdmin}}),k=y(()=>{try{const o=K();return o.hasPermission(le.EDIT_INVENTORY)||o.isAdmin()}catch(o){return console.warn("Rol servisi erişilemedi (canEditInventory), authStore.canEditItems kullanılıyor",o),C.canEditItems}}),v=m(!1),b=m(""),h=m(1),w=m(10),S=m(!1),f=m(null),p=m(null),u=m({show:!1,message:"",type:"info"}),x=m({categoryId:""}),O=y(()=>d.getProducts),W=y(()=>d.getCategories),L=y(()=>{let o=[...O.value];if(p.value!==null){console.log(`Ürünler ${p.value} projesine göre filtreleniyor`);const i=d.getStocksByProject(p.value).map(r=>r.productId);o=o.filter(r=>i.includes(r.id))}if(!z.value){const t=C.getAuthorizedDepot;if(t){const i=d.getWarehouses.find(r=>r.code===t);i?o=o.filter(r=>d.stocks.find(j=>j.productId===r.id&&j.warehouseId===i.id)!==void 0):o=[]}}if(x.value.categoryId&&(o=o.filter(t=>t.categoryId===x.value.categoryId)),b.value){const t=b.value.toLowerCase();o=o.filter(i=>{var r;return i.code.toLowerCase().includes(t)||i.name.toLowerCase().includes(t)||(((r=i.description)==null?void 0:r.toLowerCase().includes(t))??!1)})}return o}),B=y(()=>Math.max(1,Math.ceil(L.value.length/w.value))),N=y(()=>{const o=(h.value-1)*w.value,t=o+w.value;return L.value.slice(o,t)}),A=async()=>{v.value=!0;try{d.isInitialized?await d.refreshData():await d.initializeStore(),p.value&&console.log("Ürünler aktif projeye göre filtreleniyor:",p.value)}catch(o){console.error("Ürünler yüklenirken hata:",o),P("Ürünler yüklenirken bir hata oluştu","error")}finally{setTimeout(()=>{v.value=!1},300)}},P=(o,t="info")=>{u.value={show:!0,message:o,type:t},setTimeout(()=>{u.value.show=!1},3e3)},X=()=>{u.value.show=!1},F=o=>{f.value=o,S.value=!0},H=()=>{S.value=!1,f.value=null},J=async()=>{if(f.value){v.value=!0;try{await d.deleteProduct(f.value.id),P(`"${f.value.name}" ürünü başarıyla silindi`,"success"),S.value=!1,f.value=null}catch(o){console.error("Ürün silinirken hata oluştu:",o),P("Ürün silinirken bir hata oluştu","error")}finally{v.value=!1}}},Q=o=>o.totalStock>o.minStockLevel?"Normal":o.totalStock===o.minStockLevel?"Kritik":"Düşük";return te(async()=>{p.value=Y.activeProjectId;const o=t=>{console.log("Ürünler sayfası: Proje değişikliği algılandı:",t),p.value=t,A()};M.on("project-changed",o),oe(()=>{M.off("project-changed",o)}),await A()}),(o,t)=>{var r;const i=ne("router-link");return n(),l("div",null,[e("div",me,[e("div",ve,[t[8]||(t[8]=e("h5",{class:"font-semibold timport { ref, computed, onMounted, onBeforeUnmount, watch } from 'vue'; import { useInventoryStore } from '@/stores/inventory'; import { useAuthStore } from '@/stores/auth-store'; import { useProjectStore } from '@/stores/projects'; import { eventBus } from '@/composables/eventBus'; import { getRoleService, PermissionType } from '@/services/auth/role-service'; import IconPlus from '@/components/icon/icon-plus.vue'; import IconPencil from '@/components/icon/icon-pencil.vue'; import IconTrashLines from '@/components/icon/icon-trash-lines.vue'; import IconX from '@/components/icon/icon-x.vue'; import IconCircleCheck from '@/components/icon/icon-circle-check.vue'; import IconInfoTriangle from '@/components/icon/icon-info-triangle.vue'; import IconInfoCircle from '@/components/icon/icon-info-circle.vue';text-white-light"},"Ürünler",-1)),e("div",fe,[e("div",pe,[e("div",ye,[T(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>x.value.categoryId=s),class:"form-select"},[t[5]||(t[5]=e("option",{value:""},"Tüm Kategoriler",-1)),(n(!0),l(V,null,$(W.value,s=>(n(),l("option",{key:s.id,value:s.id},a(s.name),9,he))),128))],512),[[E,x.value.categoryId]])]),e("div",ge,[T(e("input",{type:"text",class:"form-input","onUpdate:modelValue":t[1]||(t[1]=s=>b.value=s),placeholder:"Ürün ara..."},null,512),[[se,b.value]])])]),e("div",ke,[k.value?(n(),g(i,{key:0,to:"/inventory/products/manage",class:"btn btn-info"},{default:D(()=>[t[6]||(t[6]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-5 h-5 ltr:mr-2 rtl:ml-2"},[e("path",{d:"M12 20h9"}),e("path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"}),e("path",{d:"m15 5 3 3"})],-1)),z.value?(n(),l("span",be,"Ürün Yönetimi")):(n(),l("span",we,"Depoya Ürün Ekle"))]),_:1})):c("",!0),k.value?(n(),g(i,{key:1,to:"/inventory/products/add",class:"btn btn-primary"},{default:D(()=>[I(ae,{class:"w-5 h-5 ltr:mr-2 rtl:ml-2"}),t[7]||(t[7]=_(" Yeni Ürün "))]),_:1})):c("",!0)])])]),e("div",xe,[e("table",_e,[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",null,"Ürün Kodu"),e("th",null,"Ürün Adı"),e("th",null,"Kategori"),e("th",null,"Alt Kategori"),e("th",null,"Stok Numarası"),e("th",null,"Toplam Stok"),e("th",null,"Durum"),e("th",null,"İşlemler")])],-1)),e("tbody",null,[v.value?(n(),l("tr",Ie,t[9]||(t[9]=[e("td",{colspan:"8",class:"text-center"},[e("div",{class:"flex justify-center items-center p-4"},[e("div",{class:"animate-spin rounded-full h-6 w-6 border-2 border-primary border-l-transparent"})])],-1)]))):N.value.length===0?(n(),l("tr",Se,[e("td",Ce,a(b.value||x.value.categoryId?"Arama kriterlerinize uygun ürün bulunamadı.":"Henüz ürün bulunmamaktadır."),1)])):c("",!0),t[10]||(t[10]=_()),(n(!0),l(V,null,$(N.value,s=>(n(),l("tr",{key:s.id},[e("td",null,a(s.code),1),e("td",null,a(s.name),1),e("td",null,a(s.category.name),1),e("td",null,a(s.subCategory||"-"),1),e("td",null,a(s.stockNumber||"-"),1),e("td",null,a(s.totalStock),1),e("td",null,[e("span",{class:U({"badge badge-success text-black":s.totalStock>s.minStockLevel,"badge badge-warning text-black":s.totalStock===s.minStockLevel,"badge badge-danger text-black":s.totalStock<s.minStockLevel})},a(Q(s)),3)]),e("td",null,[e("div",Pe,[k.value?(n(),g(i,{key:0,to:`/inventory/products/edit/${s.id}`,class:"btn btn-sm btn-outline-primary"},{default:D(()=>[I(ie,{class:"w-4.5 h-4.5"})]),_:2},1032,["to"])):c("",!0),k.value?(n(),l("button",{key:1,class:"btn btn-sm btn-outline-danger",onClick:j=>F(s)},[I(ue,{class:"w-4.5 h-4.5"})],8,je)):c("",!0),k.value?c("",!0):(n(),l("span",Te," (Düzenleme yetkisi yok) "))])])]))),128))])])]),e("div",De,[e("div",ze,[T(e("select",{class:"form-select w-20","onUpdate:modelValue":t[2]||(t[2]=s=>w.value=s)},t[12]||(t[12]=[e("option",null,"10",-1),e("option",null,"20",-1),e("option",null,"50",-1),e("option",null,"100",-1)]),512),[[E,w.value]]),t[13]||(t[13]=e("span",null,"kayıt gösteriliyor",-1))]),e("div",Le,[e("button",{class:"btn btn-outline-primary p-2",disabled:h.value===1,onClick:t[3]||(t[3]=s=>h.value--)}," ← ",8,Be),e("span",null,"Sayfa "+a(h.value)+" / "+a(B.value),1),e("button",{class:"btn btn-outline-primary p-2",disabled:h.value===B.value,onClick:t[4]||(t[4]=s=>h.value++)}," → ",8,Ne)])])]),S.value?(n(),l("div",Ae,[e("div",Me,[e("div",Ee,[e("div",Ve,[I(R,{class:"w-12 h-12"})]),t[17]||(t[17]=e("h5",{class:"font-semibold text-lg mb-2"},"Ürün Silme",-1)),e("p",$e,[e("strong",null,a((r=f.value)==null?void 0:r.name),1),t[14]||(t[14]=_(" ürününü silmek istediğinizden emin misiniz?")),t[15]||(t[15]=e("br",null,null,-1)),t[16]||(t[16]=_(" Bu işlem geri alınamaz. "))])]),e("div",Ue,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:H}," İptal "),e("button",{type:"button",class:"btn btn-danger",onClick:J,disabled:v.value},[v.value?(n(),l("span",Re,"↻")):c("",!0),t[18]||(t[18]=_(" Evet, Sil "))],8,Ke)])])])):c("",!0),u.value.show?(n(),l("div",{key:1,class:U(["fixed top-4 right-4 p-4 rounded shadow-md z-50 transition-all duration-300",{"bg-green-500 text-white":u.value.type==="success","bg-red-500 text-white":u.value.type==="error","bg-blue-500 text-white":u.value.type==="info"}])},[e("div",Ye,[u.value.type==="success"?(n(),g(de,{key:0,class:"w-5 h-5"})):u.value.type==="error"?(n(),g(R,{key:1,class:"w-5 h-5"})):u.value.type==="info"?(n(),g(re,{key:2,class:"w-5 h-5"})):c("",!0),e("span",null,a(u.value.message),1),e("button",{class:"ml-4 text-white hover:text-gray-200",onClick:X},[I(ce,{class:"w-4 h-4"})])])],2)):c("",!0)])}}});export{Ze as default};
