import{y as be,l as pe,a5 as fe,r as v,F as B,m as _,t as ye,ac as S,a4 as H,c as n,a as t,K as w,d as m,e as A,S as D,U as z,a6 as O,O as u,L as q,M as y,N as Y,P as ke,a8 as G,a7 as T,o,V as L}from"./index-CMVsiJL9.js";const ge={class:"panel"},je={class:"flex mb-5 justify-between"},he={class:"flex items-center"},Pe={key:0,class:"animate-spin border-2 border-primary border-l-transparent rounded-full w-5 h-5 inline-block align-middle"},we={key:0},Ae={class:"table-responsive"},xe={class:"table-striped"},Ie={class:"font-semibold"},_e={class:"flex items-center gap-2"},De=["onClick"],ze=["onClick"],Ue=["onClick"],$e=["onClick"],Ce={key:1,class:"text-center py-8"},Ke={key:0},Ee={key:1},Se={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},Te={class:"panel w-11/12 sm:w-3/4 md:w-2/3 lg:w-1/2 max-h-[90vh] overflow-y-auto"},Me={class:"flex justify-between items-center mb-5"},We={class:"font-semibold text-lg"},Re={class:"mb-5"},Ve={class:"mb-5"},Fe={class:"mb-5"},Ne={class:"mb-5"},Be={class:"inline-flex"},He={class:"flex justify-end gap-4 mt-8"},Oe=["disabled"],qe={key:0,class:"animate-spin border-2 border-white border-l-transparent rounded-full w-4 h-4 inline-block align-middle ml-2"},Ye={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},Ge={class:"panel w-11/12 sm:w-3/4 md:w-2/3 lg:w-1/2 max-h-[90vh] overflow-y-auto"},Je={class:"flex justify-between items-center mb-5"},Le={class:"font-semibold text-lg"},Qe={class:"mb-5 border-b pb-5"},Xe={class:"grid grid-cols-1 sm:grid-cols-3 gap-4"},Ze=["value"],et={class:"flex items-end"},tt=["disabled"],lt={key:0,class:"animate-spin border-2 border-white border-l-transparent rounded-full w-4 h-4 inline-block align-middle ml-2"},st={key:0},ot={class:"table-responsive"},nt={class:"table-striped"},at=["onUpdate:modelValue","onChange"],rt=["onClick","disabled"],it={key:1,class:"text-center py-5"},dt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},ut={class:"panel w-11/12 sm:w-3/4 md:w-2/3 lg:w-1/2 max-h-[90vh] overflow-y-auto"},ct={class:"flex justify-between items-center mb-5"},mt={class:"font-semibold text-lg"},vt={class:"mb-5 border-b pb-5"},bt={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},pt=["value"],ft={class:"flex items-end"},yt=["disabled"],kt={key:0,class:"animate-spin border-2 border-white border-l-transparent rounded-full w-4 h-4 inline-block align-middle ml-2"},gt={key:0},jt={class:"table-responsive"},ht={class:"table-striped"},Pt=["onClick"],wt={key:1,class:"text-center py-5"},It=be({__name:"projeler",setup(At){const k=pe(),i=fe(),x=v(!1),M=v(!1),W=v(!1),U=v("add"),d=v(null),a=B({id:"",name:"",description:"",managerEmail:"",isActive:!0}),b=B({userId:"",role:"user"}),P=B({warehouseId:""}),g=v([]),$=v([]),j=v([]),C=v([]),R=v(!1),p=_(()=>{var l,e;return(e=(l=k.userInfo)==null?void 0:l.roles)==null?void 0:e.includes(H.ADMIN)}),I=_(()=>{var l,e;return(e=(l=k.userInfo)==null?void 0:l.roles)==null?void 0:e.includes(H.PROJECT_ADMIN)}),K=v([]);ye(async()=>{var l;try{if(i.isInitialized||await i.initializeStore(),await Z(),await ee(),I.value&&((l=k.userInfo)!=null&&l.id))try{const e=S.getProjectIdsAssignedToUser;if(typeof e=="function")try{const c=await e(k.userInfo.id,H.PROJECT_ADMIN);c&&Array.isArray(c)&&(K.value=c)}catch(c){console.error("getProjectIdsAssignedToUser fonksiyonu hata verdi:",c)}else console.warn("projectService.getProjectIdsAssignedToUser fonksiyonu bulunamadı. Proje Admini proje filtresi çalışmayacak.")}catch(e){console.error("Proje Admini'ne atanmış projeler getirilirken hata:",e),r("Proje Admini projeleri getirilirken hata oluştu.","error")}}catch(e){console.error("Sayfa yüklenirken hata:",e),r("Veriler yüklenirken hata oluştu","error")}});const J=_(()=>{try{return!i.projects||!Array.isArray(i.projects)?[]:p.value?i.projects:I.value?K.value&&K.value.length>0?i.projects.filter(l=>l&&l.id&&K.value.includes(l.id)):[]:[]}catch(l){return console.error("Proje listesi oluşturulurken hata:",l),[]}}),Q=_(()=>{const l=g.value.map(e=>e.id);return $.value.filter(e=>!l.includes(e.id))}),X=_(()=>{const l=j.value.map(e=>e.id);return C.value.filter(e=>!l.includes(e.id))});async function Z(){try{$.value=await k.getAllUsers(),console.log(`${$.value.length} kullanıcı yüklendi`)}catch(l){console.error("Kullanıcılar yüklenirken hata:",l),r("Kullanıcılar yüklenirken hata oluştu","error")}}async function ee(){try{C.value=await S.getAllWarehouses(),console.log(`${C.value.length} depo yüklendi`)}catch(l){console.error("Depolar yüklenirken hata:",l),r("Depolar yüklenirken hata oluştu","error")}}function V(l,e){U.value=l,l==="add"?(a.id="",a.name="",a.description="",a.managerEmail="",a.isActive=!0):l==="edit"&&e&&(a.id=e.id,a.name=e.name,a.description=e.description||"",a.managerEmail=e.managerEmail||"",a.isActive=e.isActive!==void 0?e.isActive:!0),x.value=!0}async function te(){try{U.value==="add"?(await i.addProject({name:a.name,description:a.description,managerEmail:a.managerEmail,isActive:a.isActive}),r("Proje başarıyla oluşturuldu","success")):(await i.updateProject(a.id,{name:a.name,description:a.description,managerEmail:a.managerEmail,isActive:a.isActive}),r("Proje başarıyla güncellendi","success")),x.value=!1}catch(l){r(`Hata: ${l.message||"İşlem başarısız"}`,"error")}}function le(l){confirm(`"${l.name}" projesini silmek istediğinize emin misiniz?`)&&se(l.id)}async function se(l){try{await i.deleteProject(l),r("Proje başarıyla silindi","success")}catch(e){r(`Hata: ${e.message||"İşlem başarısız"}`,"error")}}async function oe(l){d.value=l,M.value=!0,b.userId="",b.role="user",await E(l.id)}async function E(l){try{const e=await S.getUsersByProjectId(l);g.value=[];for(const c of e){const f=$.value.find(s=>s.id===c.userId);f&&g.value.push({...f,projectRole:c.role})}console.log(`${g.value.length} kullanıcı projede bulunuyor`)}catch(e){console.error("Proje kullanıcıları yüklenirken hata:",e),r("Kullanıcılar yüklenirken hata oluştu","error"),g.value=[]}}async function ne(){if(!(!d.value||!b.userId))try{await i.addUserToProject(b.userId,d.value.id,b.role),await E(d.value.id),b.userId="",r("Kullanıcı projeye eklendi","success")}catch(l){r(`Hata: ${l.message||"İşlem başarısız"}`,"error")}}async function ae(l,e){if(d.value)try{await i.updateUserProjectRole(l,d.value.id,e),r("Kullanıcı rolü güncellendi","success")}catch(c){r(`Hata: ${c.message||"İşlem başarısız"}`,"error"),await E(d.value.id)}}function re(l){var e;if(l.id===((e=k.userInfo)==null?void 0:e.id)){r("Kendi kullanıcınızı projeden çıkaramazsınız","error");return}confirm(`"${l.name}" kullanıcısını projeden çıkarmak istediğinize emin misiniz?`)&&ie(l.id)}async function ie(l){if(d.value)try{await i.removeUserFromProject(l,d.value.id),await E(d.value.id),r("Kullanıcı projeden çıkarıldı","success")}catch(e){r(`Hata: ${e.message||"İşlem başarısız"}`,"error")}}async function de(l){d.value=l,W.value=!0,P.warehouseId="",await F(l.id)}async function F(l){try{const e=await S.getWarehousesByProjectId(l);j.value=[];for(const c of e){const f=C.value.find(s=>s.id===c.warehouseId);f&&j.value.push({...f,isActive:c.isActive})}console.log(`${j.value.length} depo projede bulunuyor`)}catch(e){console.error("Proje depoları yüklenirken hata:",e),r("Depolar yüklenirken hata oluştu","error"),j.value=[]}}async function ue(){if(!(!d.value||!P.warehouseId))try{await i.addWarehouseToProject(P.warehouseId,d.value.id),await F(d.value.id),P.warehouseId="",r("Depo projeye eklendi","success")}catch(l){r(`Hata: ${l.message||"İşlem başarısız"}`,"error")}}function ce(l){confirm(`"${l.name}" deposunu projeden çıkarmak istediğinize emin misiniz?`)&&me(l.id)}async function me(l){if(d.value)try{await i.removeWarehouseFromProject(l,d.value.id),await F(d.value.id),r("Depo projeden çıkarıldı","success")}catch(e){r(`Hata: ${e.message||"İşlem başarısız"}`,"error")}}function ve(l){try{const e=new Date(l);return new Intl.DateTimeFormat("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)}catch(e){return console.error("Tarih formatlanırken hata:",e),l}}function r(l,e="success"){alert(l)}return(l,e)=>{var c,f;return o(),n("div",null,[t("div",ge,[t("div",je,[t("div",he,[e[13]||(e[13]=t("h5",{class:"font-semibold text-lg dark:text-white-light mr-2"},"Proje Yönetimi",-1)),w(i).loading||R.value?(o(),n("span",Pe)):m("",!0)]),p.value?(o(),n("button",{key:0,type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=s=>V("add"))},e[14]||(e[14]=[t("span",{class:"material-icons-outlined"},"add",-1),A(" Yeni Proje ")]))):m("",!0)]),J.value.length>0?(o(),n("div",we,[t("div",Ae,[t("table",xe,[e[19]||(e[19]=t("thead",null,[t("tr",null,[t("th",null,"Proje Adı"),t("th",null,"Açıklama"),t("th",null,"Oluşturulma Tarihi"),t("th",null,"Durum"),t("th",null,"İşlemler")])],-1)),t("tbody",null,[(o(!0),n(D,null,z(J.value,s=>(o(),n("tr",{key:s.id},[t("td",Ie,u(s.name),1),t("td",null,u(s.description||"-"),1),t("td",null,u(ve(s.createdAt)),1),t("td",null,[t("span",{class:L({"badge badge-outline-success":s.isActive,"badge badge-outline-danger":!s.isActive})},u(s.isActive?"Aktif":"Pasif"),3)]),t("td",null,[t("div",_e,[p.value?(o(),n("button",{key:0,type:"button",class:"btn btn-sm btn-outline-primary",onClick:h=>V("edit",s)},e[15]||(e[15]=[t("span",{class:"material-icons-outlined text-sm"},"Düzenle",-1)]),8,De)):m("",!0),p.value||I.value?(o(),n("button",{key:1,type:"button",class:"btn btn-sm btn-outline-info",onClick:h=>oe(s)},e[16]||(e[16]=[t("span",{class:"material-icons-outlined text-sm"},"Kullanıcılar",-1)]),8,ze)):m("",!0),p.value||I.value?(o(),n("button",{key:2,type:"button",class:"btn btn-sm btn-outline-success",onClick:h=>de(s)},e[17]||(e[17]=[t("span",{class:"material-icons-outlined text-sm"},"Depolar",-1)]),8,Ue)):m("",!0),p.value?(o(),n("button",{key:3,type:"button",class:"btn btn-sm btn-outline-danger",onClick:h=>le(s)},e[18]||(e[18]=[t("span",{class:"material-icons-outlined text-sm"},"Sil",-1)]),8,$e)):m("",!0)])])]))),128))])])])])):(o(),n("div",Ce,[e[21]||(e[21]=t("div",{class:"text-gray-400 mb-4"},[t("span",{class:"material-icons-outlined text-6xl"},"folder_off")],-1)),p.value||I.value?(o(),n("p",Ke,"Henüz gösterilecek proje bulunmuyor.")):(o(),n("p",Ee,"Bu sayfayı görüntüleme yetkiniz bulunmamaktadır.")),p.value?(o(),n("button",{key:2,type:"button",class:"btn btn-primary mt-4",onClick:e[1]||(e[1]=s=>V("add"))},e[20]||(e[20]=[t("span",{class:"material-icons-outlined"},"add",-1),A(" İlk Projeyi Oluştur ")]))):m("",!0)]))]),(o(),O(G,{to:"body"},[x.value?(o(),n("div",Se,[t("div",Te,[t("div",Me,[t("h5",We,u(U.value==="add"?"Yeni Proje Oluştur":"Projeyi Düzenle"),1),t("button",{type:"button",class:"text-gray-400 hover:text-gray-800",onClick:e[2]||(e[2]=s=>x.value=!1)},e[22]||(e[22]=[t("span",{class:"material-icons-outlined"},"Kapat",-1)]))]),t("form",{onSubmit:q(te,["prevent"])},[t("div",Re,[e[23]||(e[23]=t("label",{for:"name",class:"form-label"},[A("Proje Adı "),t("span",{class:"text-danger"},"*")],-1)),y(t("input",{id:"name",type:"text",class:"form-input","onUpdate:modelValue":e[3]||(e[3]=s=>a.name=s),placeholder:"Proje Adı",required:""},null,512),[[Y,a.name]])]),t("div",Ve,[e[24]||(e[24]=t("label",{for:"description",class:"form-label"},"Açıklama",-1)),y(t("textarea",{id:"description",class:"form-textarea","onUpdate:modelValue":e[4]||(e[4]=s=>a.description=s),placeholder:"Proje açıklaması"},null,512),[[Y,a.description]])]),t("div",Fe,[e[25]||(e[25]=t("label",{for:"managerEmail",class:"form-label"},"Proje Yöneticisi Email",-1)),y(t("input",{id:"managerEmail",type:"email",class:"form-input","onUpdate:modelValue":e[5]||(e[5]=s=>a.managerEmail=s),placeholder:"ornek@firma.com"},null,512),[[Y,a.managerEmail]])]),t("div",Ne,[t("label",Be,[y(t("input",{type:"checkbox",class:"form-checkbox","onUpdate:modelValue":e[6]||(e[6]=s=>a.isActive=s)},null,512),[[ke,a.isActive]]),e[26]||(e[26]=t("span",null,"Aktif",-1))])]),t("div",He,[t("button",{type:"button",class:"btn btn-outline-danger",onClick:e[7]||(e[7]=s=>x.value=!1)},"İptal"),t("button",{type:"submit",class:"btn btn-primary",disabled:w(i).loading},[A(u(U.value==="add"?"Oluştur":"Güncelle")+" ",1),w(i).loading?(o(),n("span",qe)):m("",!0)],8,Oe)])],32)])])):m("",!0)])),(o(),O(G,{to:"body"},[M.value?(o(),n("div",Ye,[t("div",Ge,[t("div",Je,[t("h5",Le,"Proje Kullanıcıları: "+u((c=d.value)==null?void 0:c.name),1),t("button",{type:"button",class:"text-gray-400 hover:text-gray-800",onClick:e[8]||(e[8]=s=>M.value=!1)},e[27]||(e[27]=[t("span",{class:"material-icons-outlined"},"Kapat",-1)]))]),t("div",Qe,[e[33]||(e[33]=t("h6",{class:"font-semibold mb-3"},"Kullanıcı Ekle",-1)),t("form",{onSubmit:q(ne,["prevent"])},[t("div",Xe,[t("div",null,[e[29]||(e[29]=t("label",{for:"userId",class:"form-label"},"Kullanıcı",-1)),y(t("select",{id:"userId",class:"form-select","onUpdate:modelValue":e[9]||(e[9]=s=>b.userId=s),required:""},[e[28]||(e[28]=t("option",{value:"",disabled:"",selected:""},"Kullanıcı Seçin",-1)),(o(!0),n(D,null,z(Q.value,s=>(o(),n("option",{key:s.id,value:s.id},u(s.name)+" ("+u(s.email)+") ",9,Ze))),128))],512),[[T,b.userId]])]),t("div",null,[e[31]||(e[31]=t("label",{for:"role",class:"form-label"},"Rol",-1)),y(t("select",{id:"role",class:"form-select","onUpdate:modelValue":e[10]||(e[10]=s=>b.role=s),required:""},e[30]||(e[30]=[t("option",{value:"admin"},"Admin",-1),t("option",{value:"proje_admin"},"Proje Admin",-1),t("option",{value:"user"},"Normal Kullanıcı",-1),t("option",{value:"observer"},"Gözlemci",-1),t("option",{value:"depo_sorumlusu"},"Depo Sorumlusu",-1)]),512),[[T,b.role]])]),t("div",et,[t("button",{type:"submit",class:"btn btn-primary w-full",disabled:w(i).loading},[e[32]||(e[32]=A(" Ekle ")),w(i).loading?(o(),n("span",lt)):m("",!0)],8,tt)])])],32)]),g.value.length>0?(o(),n("div",st,[e[37]||(e[37]=t("h6",{class:"font-semibold mb-3"},"Proje Kullanıcıları",-1)),t("div",ot,[t("table",nt,[e[36]||(e[36]=t("thead",null,[t("tr",null,[t("th",null,"Kullanıcı"),t("th",null,"E-posta"),t("th",null,"Rol"),t("th",null,"İşlemler")])],-1)),t("tbody",null,[(o(!0),n(D,null,z(g.value,s=>{var h;return o(),n("tr",{key:s.id},[t("td",null,u(s.name),1),t("td",null,u(s.email),1),t("td",null,[y(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":N=>s.projectRole=N,onChange:N=>ae(s.id,s.projectRole||"user")},e[34]||(e[34]=[t("option",{value:"admin"},"Admin",-1),t("option",{value:"proje_admin"},"Proje Admin",-1),t("option",{value:"user"},"Normal Kullanıcı",-1),t("option",{value:"observer"},"Gözlemci",-1),t("option",{value:"depo_sorumlusu"},"Depo Sorumlusu",-1)]),40,at),[[T,s.projectRole]])]),t("td",null,[t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:N=>re(s),disabled:s.id===((h=w(k).userInfo)==null?void 0:h.id)},e[35]||(e[35]=[t("span",{class:"material-icons-outlined text-sm"},"Kullanıcıyı Sil",-1)]),8,rt)])])}),128))])])])])):(o(),n("div",it,e[38]||(e[38]=[t("p",null,"Bu projede henüz kullanıcı bulunmuyor.",-1)])))])])):m("",!0)])),(o(),O(G,{to:"body"},[W.value?(o(),n("div",dt,[t("div",ut,[t("div",ct,[t("h5",mt,"Proje Depoları: "+u((f=d.value)==null?void 0:f.name),1),t("button",{type:"button",class:"text-gray-400 hover:text-gray-800",onClick:e[11]||(e[11]=s=>W.value=!1)},e[39]||(e[39]=[t("span",{class:"material-icons-outlined"},"Kapat",-1)]))]),t("div",vt,[e[43]||(e[43]=t("h6",{class:"font-semibold mb-3"},"Depo Ekle",-1)),t("form",{onSubmit:q(ue,["prevent"])},[t("div",bt,[t("div",null,[e[41]||(e[41]=t("label",{for:"warehouseId",class:"form-label"},"Depo",-1)),y(t("select",{id:"warehouseId",class:"form-select","onUpdate:modelValue":e[12]||(e[12]=s=>P.warehouseId=s),required:""},[e[40]||(e[40]=t("option",{value:"",disabled:"",selected:""},"Depo Seçin",-1)),(o(!0),n(D,null,z(X.value,s=>(o(),n("option",{key:s.id,value:s.id},u(s.name)+" ("+u(s.code)+") ",9,pt))),128))],512),[[T,P.warehouseId]])]),t("div",ft,[t("button",{type:"submit",class:"btn btn-primary w-full",disabled:R.value},[e[42]||(e[42]=A(" Ekle ")),R.value?(o(),n("span",kt)):m("",!0)],8,yt)])])],32)]),j.value.length>0?(o(),n("div",gt,[e[46]||(e[46]=t("h6",{class:"font-semibold mb-3"},"Projeye Atanmış Depolar",-1)),t("div",jt,[t("table",ht,[e[45]||(e[45]=t("thead",null,[t("tr",null,[t("th",null,"Depo Kodu"),t("th",null,"Depo Adı"),t("th",null,"Durum"),t("th",null,"İşlemler")])],-1)),t("tbody",null,[(o(!0),n(D,null,z(j.value,s=>(o(),n("tr",{key:s.id},[t("td",null,u(s.code),1),t("td",null,u(s.name),1),t("td",null,[t("span",{class:L({"badge badge-outline-success":s.isActive,"badge badge-outline-danger":!s.isActive})},u(s.isActive?"Aktif":"Pasif"),3)]),t("td",null,[t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:h=>ce(s)},e[44]||(e[44]=[t("span",{class:"material-icons-outlined text-sm"},"Kaldır",-1)]),8,Pt)])]))),128))])])])])):(o(),n("div",wt,e[47]||(e[47]=[t("p",null,"Bu projede henüz depo bulunmuyor.",-1)])))])])):m("",!0)]))])}}});export{It as default};
