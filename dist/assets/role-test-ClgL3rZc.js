import{y as I,l as U,r as u,m as g,t as E,c as t,a as e,e as c,O as i,S as R,U as _,M as w,N as L,V,d as A,a0 as B,a1 as j,j as M,A as N,p as P,a2 as Y,a3 as $,o,P as H,a4 as O}from"./index-CMVsiJL9.js";const G={class:"panel"},q={class:"mb-6"},J={key:0},Q={key:0},W={key:1},X={key:1},Z={class:"mb-6"},ee={key:0},se={class:"mb-2"},le={class:"mb-4"},te={key:0,class:"mt-2"},oe={class:"list-disc pl-4"},ae={key:1},ne={key:1},ie={class:"mb-6"},re={key:0},ue={class:"mb-2"},de={key:0},ce={key:1},me={key:0,class:"mt-2"},ve={class:"list-disc pl-4"},be={key:1},fe={key:1},ye={class:"mb-6"},ke={class:"mb-4"},pe={class:"mb-4"},ge={class:"grid grid-cols-1 gap-2 sm:grid-cols-2 md:grid-cols-3"},Re=["id","value"],_e=["for"],he={key:0,class:"mt-3"},De=I({__name:"role-test",setup(xe){const D=U(),b=u(null);function f(){if(!b.value)try{b.value=$()}catch(l){console.error("Rol servisi henüz başlatılmamış:",l)}return b.value}const r=u(null),S=g(()=>{const l=f();return(l==null?void 0:l.isAdmin())||!1}),y=g(()=>{const l=f();return(l==null?void 0:l.getUserPermissions())||[]}),z=g(()=>Object.values(O)),h=u(!1),d=u(null),k=u(!1),m=u(""),v=u([]),n=u(null);async function x(){try{h.value=!0,d.value=D.userInfo,console.log("Kullanıcı bilgisi yüklendi:",d.value)}catch(l){console.error("Kullanıcı bilgisi yüklenirken hata:",l),d.value=null}}async function p(){try{const l=f();return l?(await l.initializeRoles(),console.log("Roller başarıyla başlatıldı"),!0):(console.error("Rol servisi başlatılamadı"),!1)}catch(l){return console.error("Roller başlatılırken hata:",l),!1}}async function T(){try{const l=await B();n.value={timestamp:new Date().toLocaleString(),...l},console.log("Firebase rol testi sonucu:",n.value)}catch(l){n.value={timestamp:new Date().toLocaleString(),error:l.message||"Firebase rol testi sırasında hata oluştu"},console.error("Firebase rol testi hatası:",l)}}async function K(){try{if(!await p()){console.error("Roller başlatılamadığı için kontrol işlemi yapılamıyor");return}k.value=!0,console.log("Rol durumu kontrolü tamamlandı"),console.log("İzinler:",y.value)}catch(l){console.error("Rol durumu kontrolü sırasında hata:",l),k.value=!1}}async function C(){try{if(!m.value){r.value={success:!1,message:"Lütfen bir kullanıcı ID girin"};return}if(v.value.length===0){r.value={success:!1,message:"Lütfen en az bir rol seçin"};return}const l=j(),s=M(l,"users",m.value);if(!(await N(s)).exists()){r.value={success:!1,message:"Kullanıcı bulunamadı"};return}await P(s,{roles:Y(...v.value)}),r.value={success:!0,message:`Seçilen roller (${v.value.join(", ")}) kullanıcıya eklendi`},console.log(`Roller ${m.value} kullanıcısına eklendi`)}catch(l){r.value={success:!1,message:l.message||"Roller eklenirken bir hata oluştu"},console.error("Rol ekleme hatası:",l)}}return E(async()=>{await x();try{await p()}catch(l){console.warn("Roller sayfa yüklenirken otomatik olarak başlatılamadı:",l)}}),(l,s)=>(o(),t("div",null,[e("div",G,[s[16]||(s[16]=e("div",{class:"mb-5 flex items-center justify-between"},[e("h5",{class:"text-lg font-semibold dark:text-white-light"},"Rol Yönetimi Test Sayfası")],-1)),e("div",{class:"mb-6 grid grid-cols-1 gap-4"},[e("div",{class:"flex flex-wrap gap-4"},[e("button",{type:"button",class:"btn btn-primary",onClick:x},"Kullanıcı Bilgilerini Yükle"),e("button",{type:"button",class:"btn btn-success",onClick:p},"Rolleri Yükle"),e("button",{type:"button",class:"btn btn-info",onClick:T},"Firebase Rolleri Test Et"),e("button",{type:"button",class:"btn btn-warning",onClick:K},"Rol Durumu Kontrol Et")])]),e("div",q,[s[5]||(s[5]=e("h6",{class:"mb-3 text-base font-medium"},"Kullanıcı Bilgileri",-1)),h.value?(o(),t("div",J,[d.value?(o(),t("div",Q,[e("div",null,[s[2]||(s[2]=e("span",{class:"font-semibold"},"ID:",-1)),c(" "+i(d.value.id),1)]),e("div",null,[s[3]||(s[3]=e("span",{class:"font-semibold"},"Email:",-1)),c(" "+i(d.value.email),1)]),e("div",null,[s[4]||(s[4]=e("span",{class:"font-semibold"},"Rol:",-1)),c(" "+i(d.value.role),1)])])):(o(),t("div",W,"Kullanıcı bilgisi yüklenemedi"))])):(o(),t("div",X,"Kullanıcı bilgileri yükleniyor..."))]),e("div",Z,[s[8]||(s[8]=e("h6",{class:"mb-3 text-base font-medium"},"Rol Test İşlemleri",-1)),k.value?(o(),t("div",ee,[e("div",se,[s[6]||(s[6]=e("span",{class:"font-semibold"},"Admin mi:",-1)),c(" "+i(S.value?"Evet":"Hayır"),1)]),e("div",le,[s[7]||(s[7]=e("span",{class:"font-semibold"},"İzinler:",-1)),y.value.length>0?(o(),t("div",te,[e("ul",oe,[(o(!0),t(R,null,_(y.value,a=>(o(),t("li",{key:a},i(a),1))),128))])])):(o(),t("div",ae,"İzin bulunamadı"))])])):(o(),t("div",ne,"Roller henüz test edilmedi"))]),e("div",ie,[s[12]||(s[12]=e("h6",{class:"mb-3 text-base font-medium"},"Firebase Rol Testi Sonucu",-1)),n.value?(o(),t("div",re,[e("div",ue,[s[9]||(s[9]=e("span",{class:"font-semibold"},"Tarih:",-1)),c(" "+i(n.value.timestamp),1)]),n.value.error?(o(),t("div",de,[s[10]||(s[10]=e("span",{class:"font-semibold text-danger"},"Hata:",-1)),c(" "+i(n.value.error),1)])):(o(),t("div",ce,[s[11]||(s[11]=e("span",{class:"font-semibold"},"Roller:",-1)),n.value.roles&&n.value.roles.length>0?(o(),t("div",me,[e("ul",ve,[(o(!0),t(R,null,_(n.value.roles,a=>(o(),t("li",{key:a},i(a),1))),128))])])):(o(),t("div",be,"Rol bulunamadı"))]))])):(o(),t("div",fe,"Test henüz yapılmadı"))]),e("div",ye,[s[15]||(s[15]=e("h6",{class:"mb-3 text-base font-medium"},"Kullanıcıya Rol Ekle",-1)),e("div",ke,[s[13]||(s[13]=e("label",{for:"userId",class:"mb-2 block text-sm font-medium"},"Kullanıcı ID",-1)),w(e("input",{type:"text",id:"userId","onUpdate:modelValue":s[0]||(s[0]=a=>m.value=a),class:"form-input",placeholder:"Kullanıcı ID"},null,512),[[L,m.value]])]),e("div",pe,[s[14]||(s[14]=e("label",{class:"mb-2 block text-sm font-medium"},"Roller",-1)),e("div",ge,[(o(!0),t(R,null,_(z.value,a=>(o(),t("div",{key:a,class:"flex items-center"},[w(e("input",{type:"checkbox",id:"role-"+a,value:a,"onUpdate:modelValue":s[1]||(s[1]=F=>v.value=F),class:"form-checkbox"},null,8,Re),[[H,v.value]]),e("label",{for:"role-"+a,class:"ml-2"},i(a),9,_e)]))),128))])]),e("button",{type:"button",class:"btn btn-primary",onClick:C},"Rolleri Ekle"),r.value?(o(),t("div",he,[e("div",{class:V(r.value.success?"text-success":"text-danger")},i(r.value.message),3)])):A("",!0)])])]))}});export{De as default};
