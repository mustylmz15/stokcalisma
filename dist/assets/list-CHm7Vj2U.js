import{d as q,G,u as H,r as c,e as h,a as X,i as o,j as e,s as D,x as B,F as M,k as N,v as Y,p as S,T as x,m as V,K as d,y as a,l as w,q as I,D as $,B as J,C as n,a7 as Q,an as R}from"./index-d431Q8yB.js";import{I as Z}from"./icon-plus-GW1fWUBD.js";import{_ as ee}from"./icon-pencil.vue_vue_type_script_setup_true_lang-xfKVdPJ3.js";import{I as te}from"./icon-trash-lines-ug_c1Xl1.js";import{I as j,a as se}from"./icon-info-triangle-DKMdkIao.js";const le={class:"panel"},ne={class:"flex flex-col md:flex-row items-center justify-between mb-5"},ae={class:"flex flex-col md:flex-row gap-4 w-full md:w-auto mt-4 md:mt-0"},oe={class:"flex flex-col md:flex-row gap-4"},ie={class:"flex-1 md:w-48"},re=["value"],ue={class:"flex-1"},de={class:"flex gap-2"},ce={class:"table-responsive"},me={class:"table-striped"},ve={key:0},fe={key:1},be={colspan:"8",class:"text-center"},pe={class:"flex gap-2"},ge=["onClick"],ye={key:2,class:"text-sm text-gray-500 italic"},ke={class:"flex items-center justify-between mt-5"},he={class:"flex items-center gap-2"},xe={class:"flex items-center gap-2"},we=["disabled"],_e=["disabled"],Se={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},Ie={class:"panel bg-white dark:bg-gray-800 w-full max-w-md"},Ce={class:"flex flex-col items-center mb-5"},De={class:"text-red-500 p-4"},Le={class:"text-center"},ze={class:"flex justify-center gap-4"},Te=["disabled"],Pe={key:0,class:"animate-spin mr-2"},Be={class:"flex items-center gap-2"},Ke=q({__name:"list",setup(Me){const f=G(),p=H(),m=c(!1),g=c(""),b=c(1),y=c(10),_=c(!1),v=c(null),i=c({show:!1,message:"",type:"info"}),k=c({categoryId:""}),A=h(()=>p.getProducts),K=h(()=>p.getCategories),L=h(()=>{let l=[...A.value];if(!f.isAdmin){const t=f.getAuthorizedDepot;if(t){const r=p.getWarehouses.find(u=>u.code===t);r?l=l.filter(u=>p.stocks.find(C=>C.productId===u.id&&C.warehouseId===r.id)!==void 0):l=[]}}if(k.value.categoryId&&(l=l.filter(t=>t.categoryId===k.value.categoryId)),g.value){const t=g.value.toLowerCase();l=l.filter(r=>{var u;return r.code.toLowerCase().includes(t)||r.name.toLowerCase().includes(t)||(((u=r.description)==null?void 0:u.toLowerCase().includes(t))??!1)})}return l}),z=h(()=>Math.max(1,Math.ceil(L.value.length/y.value))),T=h(()=>{const l=(b.value-1)*y.value,t=l+y.value;return L.value.slice(l,t)}),P=(l,t="info")=>{i.value={show:!0,message:l,type:t},setTimeout(()=>{i.value.show=!1},3e3)},E=()=>{i.value.show=!1},O=l=>{v.value=l,_.value=!0},U=()=>{_.value=!1,v.value=null},F=async()=>{if(v.value){m.value=!0;try{await p.deleteProduct(v.value.id),P(`"${v.value.name}" ürünü başarıyla silindi`,"success"),_.value=!1,v.value=null}catch(l){console.error("Ürün silinirken hata oluştu:",l),P("Ürün silinirken bir hata oluştu","error")}finally{m.value=!1}}},W=l=>l.totalStock>l.minStockLevel?"Normal":l.totalStock===l.minStockLevel?"Kritik":"Düşük";return X(()=>{m.value=!0,setTimeout(()=>{m.value=!1},300)}),(l,t)=>{var u;const r=J("router-link");return n(),o("div",null,[e("div",le,[e("div",ne,[t[7]||(t[7]=e("h5",{class:"font-semibold text-lg dark:text-white-light"},"Ürünler",-1)),e("div",ae,[e("div",oe,[e("div",ie,[D(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>k.value.categoryId=s),class:"form-select"},[t[5]||(t[5]=e("option",{value:""},"Tüm Kategoriler",-1)),(n(!0),o(M,null,N(K.value,s=>(n(),o("option",{key:s.id,value:s.id},a(s.name),9,re))),128))],512),[[B,k.value.categoryId]])]),e("div",ue,[D(e("input",{type:"text",class:"form-input","onUpdate:modelValue":t[1]||(t[1]=s=>g.value=s),placeholder:"Ürün ara..."},null,512),[[Y,g.value]])])]),e("div",de,[S(f).canEditItems?(n(),x(r,{key:0,to:"/inventory/products/add",class:"btn btn-primary"},{default:V(()=>[w(Z,{class:"w-5 h-5 ltr:mr-2 rtl:ml-2"}),t[6]||(t[6]=I(" Yeni Ürün "))]),_:1})):d("",!0)])])]),e("div",ce,[e("table",me,[t[9]||(t[9]=e("thead",null,[e("tr",null,[e("th",null,"Ürün Kodu"),e("th",null,"Ürün Adı"),e("th",null,"Kategori"),e("th",null,"Birim"),e("th",null,"Min. Stok"),e("th",null,"Toplam Stok"),e("th",null,"Durum"),e("th",null,"İşlemler")])],-1)),e("tbody",null,[m.value?(n(),o("tr",ve,t[8]||(t[8]=[e("td",{colspan:"8",class:"text-center"},[e("div",{class:"flex justify-center items-center p-4"},[e("div",{class:"animate-spin rounded-full h-6 w-6 border-2 border-primary border-l-transparent"})])],-1)]))):T.value.length===0?(n(),o("tr",fe,[e("td",be,a(g.value||k.value.categoryId?"Arama kriterlerinize uygun ürün bulunamadı.":"Henüz ürün bulunmamaktadır."),1)])):d("",!0),(n(!0),o(M,null,N(T.value,s=>(n(),o("tr",{key:s.id},[e("td",null,a(s.code),1),e("td",null,a(s.name),1),e("td",null,a(s.category.name),1),e("td",null,a(s.unit),1),e("td",null,a(s.minStockLevel),1),e("td",null,a(s.totalStock),1),e("td",null,[e("span",{class:$({"badge badge-success text-black":s.totalStock>s.minStockLevel,"badge badge-warning text-black":s.totalStock===s.minStockLevel,"badge badge-danger text-black":s.totalStock<s.minStockLevel})},a(W(s)),3)]),e("td",null,[e("div",pe,[S(f).isObserver?d("",!0):(n(),x(r,{key:0,to:`/inventory/products/edit/${s.id}`,class:"btn btn-sm btn-outline-primary"},{default:V(()=>[w(ee,{class:"w-4.5 h-4.5"})]),_:2},1032,["to"])),S(f).isObserver?d("",!0):(n(),o("button",{key:1,class:"btn btn-sm btn-outline-danger",onClick:C=>O(s)},[w(te,{class:"w-4.5 h-4.5"})],8,ge)),S(f).isObserver?(n(),o("span",ye," (Düzenleme yetkisi yok) ")):d("",!0)])])]))),128))])])]),e("div",ke,[e("div",he,[D(e("select",{class:"form-select w-20","onUpdate:modelValue":t[2]||(t[2]=s=>y.value=s)},t[10]||(t[10]=[e("option",null,"10",-1),e("option",null,"20",-1),e("option",null,"50",-1),e("option",null,"100",-1)]),512),[[B,y.value]]),t[11]||(t[11]=e("span",null,"kayıt gösteriliyor",-1))]),e("div",xe,[e("button",{class:"btn btn-outline-primary p-2",disabled:b.value===1,onClick:t[3]||(t[3]=s=>b.value--)}," ← ",8,we),e("span",null,"Sayfa "+a(b.value)+" / "+a(z.value),1),e("button",{class:"btn btn-outline-primary p-2",disabled:b.value===z.value,onClick:t[4]||(t[4]=s=>b.value++)}," → ",8,_e)])])]),_.value?(n(),o("div",Se,[e("div",Ie,[e("div",Ce,[e("div",De,[w(j,{class:"w-12 h-12"})]),t[15]||(t[15]=e("h5",{class:"font-semibold text-lg mb-2"},"Ürün Silme",-1)),e("p",Le,[e("strong",null,a((u=v.value)==null?void 0:u.name),1),t[12]||(t[12]=I(" ürününü silmek istediğinizden emin misiniz?")),t[13]||(t[13]=e("br",null,null,-1)),t[14]||(t[14]=I(" Bu işlem geri alınamaz. "))])]),e("div",ze,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:U}," İptal "),e("button",{type:"button",class:"btn btn-danger",onClick:F,disabled:m.value},[m.value?(n(),o("span",Pe,"↻")):d("",!0),t[16]||(t[16]=I(" Evet, Sil "))],8,Te)])])])):d("",!0),i.value.show?(n(),o("div",{key:1,class:$(["fixed top-4 right-4 p-4 rounded shadow-md z-50 transition-all duration-300",{"bg-green-500 text-white":i.value.type==="success","bg-red-500 text-white":i.value.type==="error","bg-blue-500 text-white":i.value.type==="info"}])},[e("div",Be,[i.value.type==="success"?(n(),x(se,{key:0,class:"w-5 h-5"})):i.value.type==="error"?(n(),x(j,{key:1,class:"w-5 h-5"})):i.value.type==="info"?(n(),x(R,{key:2,class:"w-5 h-5"})):d("",!0),e("span",null,a(i.value.message),1),e("button",{class:"ml-4 text-white hover:text-gray-200",onClick:E},[w(Q,{class:"w-4 h-4"})])])],2)):d("",!0)])}}});export{Ke as default};
